<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LoopTK: Protein Loop Kinematic Toolkit: src/core/PTripepClosure.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_29dfbfd23c996ac0b854f66db54924e6.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_4df2d742f9257598b4c1a9c1a0a3225b.html">core</a></div>
<h1>PTripepClosure.h</h1><a href="PTripepClosure_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    LoopTK: Protein Loop Kinematic Toolkit</span>
<a name="l00003"></a>00003 <span class="comment">    Copyright (C) 2007 Stanford University</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">    This program is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="comment">    it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="comment">    the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="comment">    (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">    This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">    You should have received a copy of the GNU General Public License along</span>
<a name="l00016"></a>00016 <span class="comment">    with this program; if not, write to the Free Software Foundation, Inc.,</span>
<a name="l00017"></a>00017 <span class="comment">    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 
<a name="l00043"></a>00043 <span class="comment">//  * b_len(1:6): bond lengths (A1-C1, C1-N2, ..., N3-A3)</span>
<a name="l00065"></a>00065 <span class="comment"></span><span class="comment">//MODULE tripep_closure</span>
<a name="l00067"></a>00067 <span class="comment"></span><span class="comment">//  integer, parameter :: dp = kind(1.0d0)</span>
<a name="l00068"></a>00068 <span class="comment">//  real(dp), parameter :: pi = 3.141592653589793238462643383279502884197d0</span>
<a name="l00069"></a><a class="code" href="PTripepClosure_8h.html#c2b1cb8b3fb7713601463e82d1d2b627">00069</a> <span class="preprocessor">  #define  pi 3.141592653589793238462643383279502884197e0</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="comment">//  real(dp), parameter :: two_pi=2.0d0*pi, deg2rad = pi/180.0d0, rad2deg = 180.0d0/pi</span>
<a name="l00071"></a><a class="code" href="PTripepClosure_8h.html#ca29ec85c5cbb1c5b525fc762158d42e">00071</a> <span class="preprocessor">  #define two_pi 2.0e0*pi</span>
<a name="l00072"></a><a class="code" href="PTripepClosure_8h.html#0224561b0395b85ca3b1c11acb093ea4">00072</a> <span class="preprocessor"></span><span class="preprocessor">  #define deg2rad pi/180.0e0</span>
<a name="l00073"></a><a class="code" href="PTripepClosure_8h.html#d0dfcdf5be10330f25162e018afca97e">00073</a> <span class="preprocessor"></span><span class="preprocessor">  #define rad2deg 180.0e0/pi</span>
<a name="l00074"></a><a class="code" href="PTripepClosure_8h.html#ba9726df73d617ec0e6116d8a1b81050">00074</a> <span class="preprocessor"></span><span class="preprocessor">  #define max(a,b) ((a) &gt; (b))? (a) : (b)</span>
<a name="l00075"></a><a class="code" href="PTripepClosure_8h.html#9cc09fd5237e54feaa3e4cee4fedc869">00075</a> <span class="preprocessor"></span><span class="preprocessor">  #define min(a,b) ((a) &lt; (b))? (a) : (b)</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span><span class="comment">//  integer, parameter :: max_soln = 16</span>
<a name="l00077"></a><a class="code" href="PTripepClosure_8h.html#b30cbf883490b0afd792226d252e9e25">00077</a>   <span class="keywordtype">int</span> <a class="code" href="PTripepClosure_8h.html#b30cbf883490b0afd792226d252e9e25">max_soln</a> = 16;
<a name="l00078"></a>00078 <span class="comment">//  integer, parameter :: deg_pol = 16</span>
<a name="l00079"></a><a class="code" href="PTripepClosure_8h.html#cccaf8a4741ba437731b0a0bdffad10c">00079</a>   <span class="keywordtype">int</span> <a class="code" href="PTripepClosure_8h.html#cccaf8a4741ba437731b0a0bdffad10c">deg_pol</a> = 16;
<a name="l00080"></a>00080 <span class="comment">//  integer, parameter :: print_level = 0</span>
<a name="l00081"></a><a class="code" href="PTripepClosure_8h.html#954d0af31e6dc5a8e0942494f03bc417">00081</a>   <span class="keywordtype">int</span> <a class="code" href="PTripepClosure_8h.html#954d0af31e6dc5a8e0942494f03bc417">print_level</a> = 1;
<a name="l00082"></a>00082 <span class="comment">//  ! parameters for tripeptide loop (including bond lengths &amp; angles)</span>
<a name="l00083"></a>00083 <span class="comment">//  real(dp) :: len0(6), b_ang0(7), t_ang0(2)</span>
<a name="l00084"></a><a class="code" href="PTripepClosure_8h.html#63fbb9689abbc7c69e6ee7f9d18372b1">00084</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[6], <a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[7], <a class="code" href="PTripepClosure_8h.html#63fbb9689abbc7c69e6ee7f9d18372b1">t_ang0</a>[2];
<a name="l00085"></a>00085 <span class="comment">//  real(dp) :: aa13_min_sqr, aa13_max_sqr</span>
<a name="l00086"></a><a class="code" href="PTripepClosure_8h.html#38fecdb3cdd8fee9b5fd20b3ffe3b8bc">00086</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#38fecdb3cdd8fee9b5fd20b3ffe3b8bc">aa13_min_sqr</a>, <a class="code" href="PTripepClosure_8h.html#302f95d1375aa6495c5fe9b293026258">aa13_max_sqr</a>;
<a name="l00087"></a>00087 <span class="comment">//  real(dp) :: delta(0:3), xi(3), eta(3), alpha(3), theta(3)</span>
<a name="l00088"></a><a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">00088</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[4], <a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[3], <a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[3], <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[3], <a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[3];
<a name="l00089"></a>00089 <span class="comment">//  real(dp) :: cos_alpha(3), sin_alpha(3), cos_theta(3), sin_theta(3)</span>
<a name="l00090"></a><a class="code" href="PTripepClosure_8h.html#616a2a20cf38fe93b9030e3e09f8d1b7">00090</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[3], <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[3], <a class="code" href="PTripepClosure_8h.html#11e189ba7a3eb629223eb7d37d0f335b">cos_theta</a>[3], <a class="code" href="PTripepClosure_8h.html#616a2a20cf38fe93b9030e3e09f8d1b7">sin_theta</a>[3];
<a name="l00091"></a>00091 <span class="comment">//  real(dp) :: cos_delta(0:3), sin_delta(0:3)</span>
<a name="l00092"></a><a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">00092</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[4], <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[4];
<a name="l00093"></a>00093 <span class="comment">//  real(dp) :: cos_xi(3), cos_eta(3), sin_xi(3), sin_eta(3)</span>
<a name="l00094"></a><a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">00094</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#8269e50c354358511ac656124788ceb1">cos_xi</a>[3], <a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[3], <a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[3], <a class="code" href="PTripepClosure_8h.html#d15cb2aaa72b0c7b5876072c271d9ff3">sin_eta</a>[3];
<a name="l00095"></a>00095 <span class="comment">//  real(dp) :: r_a1a3(3), r_a1n1(3), r_a3c3(3)</span>
<a name="l00096"></a><a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">00096</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#3e4e1a078402f602dd214030aca2c1ab">r_a1a3</a>[3], <a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>[3], <a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">r_a3c3</a>[3];
<a name="l00097"></a>00097 <span class="comment">//  real(dp) :: b_a1a3(3), b_a1n1(3), b_a3c3(3)</span>
<a name="l00098"></a><a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">00098</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>[3], <a class="code" href="PTripepClosure_8h.html#87cb2c2c73dfaae6ee90bd3c10f795b4">b_a1n1</a>[3], <a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">b_a3c3</a>[3];
<a name="l00099"></a>00099 <span class="comment">//  real(dp) :: len_na(3), len_ac(3), len_aa(3)</span>
<a name="l00100"></a><a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">00100</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[3], <a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[3], <a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[3];
<a name="l00101"></a>00101 <span class="comment">//  ! used for polynomial coefficients</span>
<a name="l00102"></a>00102 <span class="comment">//  real(dp) :: C0(0:2,3), C1(0:2,3), C2(0:2,3)</span>
<a name="l00103"></a><a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">00103</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[3][3], <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[3][3], <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[3][3];
<a name="l00104"></a>00104 <span class="comment">//  real(dp) :: Q(0:16,0:4), R(0:16,0:2)</span>
<a name="l00105"></a><a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">00105</a>   <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[5][17], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[3][17];
<a name="l00106"></a>00106 <span class="comment">//CONTAINS</span>
<a name="l00107"></a>00107 
<a name="l00109"></a>00109 <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(<span class="keywordtype">double</span> va[], <span class="keywordtype">double</span> vb[]);
<a name="l00110"></a>00110 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(<span class="keywordtype">double</span> ma[3][3], <span class="keywordtype">double</span> mb[3], <span class="keywordtype">double</span> mc[3]);
<a name="l00111"></a>00111 <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b);
<a name="l00112"></a>00112 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#0abececf5ae8dc63aa39cd3effcb9a40">solve_3pep_poly</a>(<span class="keywordtype">double</span> r_n1[3], <span class="keywordtype">double</span> r_a1[3], <span class="keywordtype">double</span> r_a3[3], <span class="keywordtype">double</span> r_c3[3], <span class="keywordtype">double</span> r_soln_n[16][3][3], <span class="keywordtype">double</span> r_soln_a[16][3][3], <span class="keywordtype">double</span> r_soln_c[16][3][3], <span class="keywordtype">int</span> *n_soln);
<a name="l00113"></a>00113 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#c13029e9c309cab97f120a2be745a0d0">initialize_loop_closure</a>(<span class="keywordtype">double</span> b_len[], <span class="keywordtype">double</span> b_ang[], <span class="keywordtype">double</span> t_ang[]);
<a name="l00114"></a>00114 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#393b38594b0a27b92779acc32f39a62d">get_input_angles</a>(<span class="keywordtype">int</span> *n_soln, <span class="keywordtype">double</span> r_n1[], <span class="keywordtype">double</span> r_a1[], <span class="keywordtype">double</span> r_a3[], <span class="keywordtype">double</span> r_c3[]);
<a name="l00115"></a>00115 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#12dc1b213051fb10d92488e781b855d6">test_two_cone_existence_soln</a>(<span class="keywordtype">double</span> tt, <span class="keywordtype">double</span> kx, <span class="keywordtype">double</span> et, <span class="keywordtype">double</span> ap, <span class="keywordtype">int</span> *n_soln, <span class="keywordtype">char</span> cone_type[]);
<a name="l00116"></a>00116 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#203eb9dfcc71e1ac2eb39d965ebe2534">get_poly_coeff</a>(<span class="keywordtype">double</span> poly_coeff[]);
<a name="l00117"></a>00117 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">double</span> u4[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">int</span> p3[2], <span class="keywordtype">int</span> p4[2], <span class="keywordtype">double</span> u5[5][5], <span class="keywordtype">int</span> p5[2]);
<a name="l00118"></a>00118 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#d6da7cd180a9c4737224e61c88a33446">poly_mul2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">int</span> p3[2]);
<a name="l00119"></a>00119 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#eefb1297cbb70b777cd9fba016c3b72e">poly_sub2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">int</span> p3[2]);
<a name="l00120"></a>00120 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<span class="keywordtype">double</span> u1[17], <span class="keywordtype">double</span> u2[17], <span class="keywordtype">double</span> u3[17], <span class="keywordtype">double</span> u4[17], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">int</span> p3, <span class="keywordtype">int</span> p4, <span class="keywordtype">double</span> u5[17], <span class="keywordtype">int</span> *p5);
<a name="l00121"></a>00121 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<span class="keywordtype">double</span> u1[], <span class="keywordtype">double</span> u2[], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">double</span> u3[], <span class="keywordtype">int</span> *p3);
<a name="l00122"></a>00122 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#6924e4c0f28687ed25104959fb15463f">poly_sub1</a>(<span class="keywordtype">double</span> u1[], <span class="keywordtype">double</span> u2[], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">double</span> u3[], <span class="keywordtype">int</span> *p3);
<a name="l00123"></a>00123 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#f44b3a456561aff184243204d214e0ea">coord_from_poly_roots</a>(<span class="keywordtype">int</span> *n_soln, <span class="keywordtype">double</span> roots[16], <span class="keywordtype">double</span> r_n1[3], <span class="keywordtype">double</span> r_a1[3], <span class="keywordtype">double</span> r_a3[3], <span class="keywordtype">double</span> r_c3[3], <span class="keywordtype">double</span> r_soln_n[16][3][3], <span class="keywordtype">double</span> r_soln_a[16][3][3], <span class="keywordtype">double</span> r_soln_c[16][3][3]);
<a name="l00124"></a>00124 <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#5d51d54f1f64b63f2edc36ed996eaee8">calc_t2</a>(<span class="keywordtype">double</span> t0);
<a name="l00125"></a>00125 <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#97edf0a2ece832b26e737203711dad8b">calc_t1</a>(<span class="keywordtype">double</span> t0, <span class="keywordtype">double</span> t2);
<a name="l00126"></a>00126 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(<span class="keywordtype">double</span> r1[], <span class="keywordtype">double</span> r2[], <span class="keywordtype">double</span> r3[], <span class="keywordtype">double</span> *angle);
<a name="l00127"></a>00127 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<span class="keywordtype">double</span> r1[], <span class="keywordtype">double</span> r2[], <span class="keywordtype">double</span> *angle);
<a name="l00128"></a>00128 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(<span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[], <span class="keywordtype">double</span> q[], <span class="keywordtype">double</span> s[]);
<a name="l00129"></a>00129 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#020855c4fb206a413e0322064b26a22a">quaternion</a>(<span class="keywordtype">double</span> axis[], <span class="keywordtype">double</span> quarter_ang, <span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[]);
<a name="l00130"></a>00130 <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#b4dcc0bfdb83aec6776142dc80418005">rotation_matrix</a>(<span class="keywordtype">double</span> q[4], <span class="keywordtype">double</span> U[3][3]);
<a name="l00132"></a>00132 
<a name="l00133"></a><a class="code" href="PTripepClosure_8h.html#3566359dbdc5bef325337831425b75d5">00133</a> <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(<span class="keywordtype">double</span> va[3], <span class="keywordtype">double</span> vb[3])
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135  <span class="keywordflow">return</span> va[0]*vb[0] + va[1]*vb[1] + va[2]*vb[2];
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137   
<a name="l00138"></a><a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">00138</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(<span class="keywordtype">double</span> ma[3][3], <span class="keywordtype">double</span> mb[3], <span class="keywordtype">double</span> mc[3])
<a name="l00139"></a>00139  {
<a name="l00140"></a>00140   <span class="keywordtype">int</span> i, j;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00143"></a>00143    {
<a name="l00144"></a>00144     mc[i] = 0.;
<a name="l00145"></a>00145     <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00146"></a>00146       mc[i] += ma[i][j]*mb[j];
<a name="l00147"></a>00147    }
<a name="l00148"></a>00148   <span class="keywordflow">return</span>;
<a name="l00149"></a>00149  }
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">00151</a> <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(<span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b)
<a name="l00152"></a>00152  {
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (b&gt;=0.)
<a name="l00154"></a>00154     <span class="keywordflow">return</span> fabs(a);
<a name="l00155"></a>00155   <span class="keywordflow">else</span>
<a name="l00156"></a>00156     <span class="keywordflow">return</span> -fabs(a);
<a name="l00157"></a>00157  }
<a name="l00159"></a>00159 <span class="comment">//subroutine solv_3pep_poly(r_n1, r_a1, r_a3, r_c3, &amp;</span>
<a name="l00160"></a>00160 <span class="comment">//     r_soln_n, r_soln_a, r_soln_c, n_soln)</span>
<a name="l00161"></a><a class="code" href="PTripepClosure_8h.html#0abececf5ae8dc63aa39cd3effcb9a40">00161</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#0abececf5ae8dc63aa39cd3effcb9a40">solve_3pep_poly</a>(<span class="keywordtype">double</span> r_n1[3], <span class="keywordtype">double</span> r_a1[3], <span class="keywordtype">double</span> r_a3[3], <span class="keywordtype">double</span> r_c3[3], <span class="keywordtype">double</span> r_soln_n[16][3][3], <span class="keywordtype">double</span> r_soln_a[16][3][3], <span class="keywordtype">double</span> r_soln_c[16][3][3], <span class="keywordtype">int</span> *n_soln)
<a name="l00162"></a>00162  {
<a name="l00163"></a>00163 <span class="comment">//  implicit none</span>
<a name="l00164"></a>00164 <span class="comment">//  real(dp), intent(in) :: r_n1(3), r_a1(3), r_a3(3), r_c3(3)</span>
<a name="l00165"></a>00165 <span class="comment">//  integer, intent(out) :: n_soln</span>
<a name="l00166"></a>00166 <span class="comment">//  real(dp), intent(out) :: r_soln_n(:,:,:), r_soln_a(:,:,:), r_soln_c(:,:,:)</span>
<a name="l00167"></a>00167 <span class="comment">//  real(dp) :: poly_coeff(0:deg_pol), roots(max_soln)</span>
<a name="l00168"></a>00168   <span class="keywordtype">double</span> poly_coeff[<a class="code" href="PTripepClosure_8h.html#cccaf8a4741ba437731b0a0bdffad10c">deg_pol</a>+1], roots[<a class="code" href="PTripepClosure_8h.html#b30cbf883490b0afd792226d252e9e25">max_soln</a>];
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment">//  call get_input_angles(n_soln, r_n1, r_a1, r_a3, r_c3)</span>
<a name="l00171"></a>00171   <a class="code" href="PTripepClosure_8h.html#393b38594b0a27b92779acc32f39a62d">get_input_angles</a>(n_soln, r_n1, r_a1, r_a3, r_c3);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">//  if (n_soln == 0) then</span>
<a name="l00174"></a>00174 <span class="comment">//     return</span>
<a name="l00175"></a>00175 <span class="comment">//  end if</span>
<a name="l00176"></a>00176   <span class="keywordflow">if</span> (*n_soln == 0)
<a name="l00177"></a>00177     <span class="keywordflow">return</span>;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="comment">//  call get_poly_coeff(poly_coeff)</span>
<a name="l00180"></a>00180   <a class="code" href="PTripepClosure_8h.html#203eb9dfcc71e1ac2eb39d965ebe2534">get_poly_coeff</a>(poly_coeff);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="comment">//  call solve_sturm(deg_pol, n_soln, poly_coeff, roots)</span>
<a name="l00183"></a>00183   <a class="code" href="PSturm_8h.html#fb3003ea1933484ebb83d4b7db3ace51">solve_sturm</a>(&amp;<a class="code" href="PTripepClosure_8h.html#cccaf8a4741ba437731b0a0bdffad10c">deg_pol</a>, n_soln, poly_coeff, roots);
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">//  if (n_soln == 0) then</span>
<a name="l00187"></a>00187 <span class="comment"></span><span class="comment">//     return</span>
<a name="l00188"></a>00188 <span class="comment">//  end if</span>
<a name="l00189"></a>00189   
<a name="l00190"></a>00190   <span class="keywordflow">if</span> (*n_soln == 0)
<a name="l00191"></a>00191   {
<a name="l00192"></a>00192      <span class="keywordflow">return</span>;
<a name="l00193"></a>00193     <span class="comment">//exit(1);</span>
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195  
<a name="l00196"></a>00196 <span class="comment">//  call coord_from_poly_roots(n_soln, roots, r_n1, r_a1, r_a3, r_c3, r_soln_n, r_soln_a, r_soln_c)</span>
<a name="l00197"></a>00197   <a class="code" href="PTripepClosure_8h.html#f44b3a456561aff184243204d214e0ea">coord_from_poly_roots</a>(n_soln, roots, r_n1, r_a1, r_a3, r_c3, r_soln_n, r_soln_a, r_soln_c);
<a name="l00198"></a>00198 
<a name="l00199"></a>00199   <span class="keywordflow">return</span>;
<a name="l00200"></a>00200 <span class="comment">//end subroutine solv_3pep_poly</span>
<a name="l00201"></a>00201  }
<a name="l00203"></a>00203 <span class="comment">//subroutine initialize_loop_closure(b_len, b_ang, t_ang)</span>
<a name="l00204"></a><a class="code" href="PTripepClosure_8h.html#973c4d1d0e2d03aafaa64f180fd67723">00204</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#c13029e9c309cab97f120a2be745a0d0">initialize_loop_closure</a>(<span class="keywordtype">double</span> b_len[6], <span class="keywordtype">double</span> b_ang[7], <span class="keywordtype">double</span> t_ang[2])
<a name="l00205"></a>00205  {
<a name="l00209"></a>00209 <span class="comment">//  implicit none</span>
<a name="l00210"></a>00210 <span class="comment">//  real(dp), intent(in) :: b_len(6), b_ang(7), t_ang(2)</span>
<a name="l00211"></a>00211 <span class="comment">//  real(dp) :: len1, len2, a_min, a_max</span>
<a name="l00212"></a>00212   <span class="keywordtype">double</span> len1, len2, a_min, a_max;
<a name="l00213"></a>00213 <span class="comment">//  real(dp), dimension(3) :: axis, rr_a1, rr_c1, rr_n2, rr_a2, rr_n2a2_ref, rr_c1a1</span>
<a name="l00214"></a>00214   <span class="keywordtype">double</span> axis[3], rr_a1[3], rr_c1[3], rr_n2[3], rr_a2[3], rr_n2a2_ref[3], rr_c1a1[3];
<a name="l00215"></a>00215 <span class="comment">//  real(dp), dimension(3) :: rr_a1a2, dr, bb_c1a1, bb_a1a2, bb_a2n2</span>
<a name="l00216"></a>00216   <span class="keywordtype">double</span> rr_a1a2[3], dr[3], bb_c1a1[3], bb_a1a2[3], bb_a2n2[3];
<a name="l00217"></a>00217 <span class="comment">//  real(dp), dimension(3) :: r_a1, r_n1</span>
<a name="l00218"></a>00218 <span class="comment">//  double r_a1[3], r_n1[3];</span>
<a name="l00219"></a>00219 <span class="comment">//  real(dp) :: p(4), Us(3,3)</span>
<a name="l00220"></a>00220   <span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[4], Us[3][3];
<a name="l00221"></a>00221   <span class="keywordtype">double</span> mulpro[3];
<a name="l00222"></a>00222   <span class="keywordtype">double</span> tmp_val[3];
<a name="l00223"></a>00223 <span class="comment">//  real(dp), parameter :: tol_secant = 1.0d-15</span>
<a name="l00224"></a>00224   <span class="keywordtype">double</span> tol_secant = 1.0e-15;
<a name="l00225"></a>00225 <span class="comment">//  integer, parameter :: max_iter_sturm = 100, max_iter_secant = 20</span>
<a name="l00226"></a>00226   <span class="keywordtype">int</span> max_iter_sturm = 100;
<a name="l00227"></a>00227   <span class="keywordtype">int</span> max_iter_secant = 20;
<a name="l00228"></a>00228 <span class="comment">//  integer :: i</span>
<a name="l00229"></a>00229   <span class="keywordtype">int</span> i, j;
<a name="l00230"></a>00230   
<a name="l00231"></a>00231 <span class="comment">//  call initialize_sturm(tol_secant, max_iter_sturm, max_iter_secant)</span>
<a name="l00232"></a>00232   <a class="code" href="PSturm_8h.html#a87d146754b3d158957bd79f906ed009">initialize_sturm</a>(&amp;tol_secant, &amp;max_iter_sturm, &amp;max_iter_secant);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="comment">//  len0(1:6) = b_len(1:6)</span>
<a name="l00235"></a>00235   <span class="keywordflow">for</span>(i=0;i&lt;6;i++)
<a name="l00236"></a>00236     <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[i] = b_len[i];
<a name="l00237"></a>00237 <span class="comment">//  b_ang0(1:7) = b_ang(1:7)</span>
<a name="l00238"></a>00238   <span class="keywordflow">for</span>(i=0;i&lt;7;i++)
<a name="l00239"></a>00239     <a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[i] = b_ang[i];
<a name="l00240"></a>00240 <span class="comment">//  t_ang0(1:2) = t_ang(1:2)</span>
<a name="l00241"></a>00241   <span class="keywordflow">for</span>(i=0;i&lt;2;i++)
<a name="l00242"></a>00242     <a class="code" href="PTripepClosure_8h.html#63fbb9689abbc7c69e6ee7f9d18372b1">t_ang0</a>[i] = t_ang[i];
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="comment">//  rr_c1(1:3) = 0.0d0</span>
<a name="l00245"></a>00245   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00246"></a>00246     rr_c1[i] = 0.;
<a name="l00247"></a>00247 <span class="comment">//  axis(1:3) = (/ 1.0d0, 0.0d0, 0.0d0 /)</span>
<a name="l00248"></a>00248   axis[0] = 1.;
<a name="l00249"></a>00249   axis[1] = 0.;
<a name="l00250"></a>00250   axis[2] = 0.;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="comment">//  do i = 0, 1</span>
<a name="l00253"></a>00253   <span class="keywordflow">for</span>(i=0;i&lt;2;i++)
<a name="l00254"></a>00254    {
<a name="l00255"></a>00255 <span class="comment">//     rr_a1(1:3) = (/ cos(b_ang0(3*i+2))*len0(3*i+1), sin(b_ang0(3*i+2))*len0(3*i+1), 0.0d0 /)</span>
<a name="l00256"></a>00256      rr_a1[0] = cos(<a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[3*i+1])*<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i];
<a name="l00257"></a>00257      rr_a1[1] = sin(<a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[3*i+1])*<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i];
<a name="l00258"></a>00258      rr_a1[2] = 0.0e0;
<a name="l00259"></a>00259 <span class="comment">//     rr_n2(1:3) = (/ len0(3*i+2), 0.0d0, 0.0d0 /)</span>
<a name="l00260"></a>00260      rr_n2[0] = <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i+1];
<a name="l00261"></a>00261      rr_n2[1] = 0.0e0;
<a name="l00262"></a>00262      rr_n2[2] = 0.0e0;
<a name="l00263"></a>00263 <span class="comment">//     rr_c1a1(:) = rr_a1(:) - rr_c1(:)</span>
<a name="l00264"></a>00264      <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00265"></a>00265        rr_c1a1[j] = rr_a1[j] - rr_c1[j];
<a name="l00266"></a>00266 <span class="comment">//     rr_n2a2_ref(1:3) = (/ -cos(b_ang0(3*i+3))*len0(3*i+3), sin(b_ang0(3*i+3))*len0(3*i+3), 0.0d0 /)</span>
<a name="l00267"></a>00267      rr_n2a2_ref[0] = -cos(<a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[3*i+2])*<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i+2];
<a name="l00268"></a>00268      rr_n2a2_ref[1] = sin(<a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[3*i+2])*<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i+2];
<a name="l00269"></a>00269      rr_n2a2_ref[2] = 0.0e0;
<a name="l00270"></a>00270 <span class="comment">//     call quaternion(axis, t_ang0(i+1)*0.25d0, p)</span>
<a name="l00271"></a>00271      <a class="code" href="PTripepClosure_8h.html#020855c4fb206a413e0322064b26a22a">quaternion</a>(axis, <a class="code" href="PTripepClosure_8h.html#63fbb9689abbc7c69e6ee7f9d18372b1">t_ang0</a>[i]*0.25e0, p);
<a name="l00272"></a>00272 <span class="comment">//     call rotation_matrix(p, Us)</span>
<a name="l00273"></a>00273      <a class="code" href="PTripepClosure_8h.html#b4dcc0bfdb83aec6776142dc80418005">rotation_matrix</a>(p, Us);
<a name="l00274"></a>00274 <span class="comment">//     rr_a2(:) =  matmul(Us, rr_n2a2_ref) + rr_n2(:)</span>
<a name="l00275"></a>00275 <span class="comment">//     rr_a1a2(:) = rr_a2(:) - rr_a1(:)</span>
<a name="l00276"></a>00276 <span class="comment">//     dr(:) = rr_a1a2(:)</span>
<a name="l00277"></a>00277      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us, rr_n2a2_ref, mulpro);
<a name="l00278"></a>00278      <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00279"></a>00279       {
<a name="l00280"></a>00280        rr_a2[j] =  mulpro[j] + rr_n2[j];
<a name="l00281"></a>00281        rr_a1a2[j] = rr_a2[j] - rr_a1[j];
<a name="l00282"></a>00282        dr[j] = rr_a1a2[j];
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284 <span class="comment">//     len2 = dot_product(dr, dr)</span>
<a name="l00285"></a>00285      len2 = <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(dr, dr);
<a name="l00286"></a>00286 <span class="comment">//     len1 = sqrt(len2)</span>
<a name="l00287"></a>00287      len1 = sqrt(len2);
<a name="l00288"></a>00288 <span class="comment">//     ! len_aa</span>
<a name="l00289"></a>00289 <span class="comment">//     len_aa(i+2) = len1</span>
<a name="l00290"></a>00290      <a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[i+1] = len1;
<a name="l00291"></a>00291 <span class="comment">//     bb_c1a1(:) = rr_c1a1(:)/len0(3*i+1)</span>
<a name="l00292"></a>00292 <span class="comment">//     bb_a1a2(:) = rr_a1a2(:)/len1</span>
<a name="l00293"></a>00293 <span class="comment">//     bb_a2n2(:) = (rr_n2(:) - rr_a2(:))/len0(3*i+3)</span>
<a name="l00294"></a>00294      <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00295"></a>00295       {
<a name="l00296"></a>00296        bb_c1a1[j] = rr_c1a1[j]/<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i];
<a name="l00297"></a>00297        bb_a1a2[j] = rr_a1a2[j]/len1;
<a name="l00298"></a>00298        bb_a2n2[j] = (rr_n2[j] - rr_a2[j])/<a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3*i+2];
<a name="l00299"></a>00299       }
<a name="l00300"></a>00300 <span class="comment">//     ! xi</span>
<a name="l00301"></a>00301 <span class="comment">//     call calc_bnd_ang(-bb_a1a2, bb_a2n2, xi(i+2))</span>
<a name="l00302"></a>00302      <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00303"></a>00303        tmp_val[j] = -bb_a1a2[j];
<a name="l00304"></a>00304      <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(tmp_val, bb_a2n2, &amp;<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[i+1]);
<a name="l00305"></a>00305 <span class="comment">//     ! eta</span>
<a name="l00306"></a>00306 <span class="comment">//     call calc_bnd_ang(bb_a1a2, -bb_c1a1, eta(i+1))</span>
<a name="l00307"></a>00307      <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l00308"></a>00308        tmp_val[j] = -bb_c1a1[j];
<a name="l00309"></a>00309      <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(bb_a1a2, tmp_val, &amp;<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i]);
<a name="l00310"></a>00310 <span class="comment">//     ! delta: pi -  dih of N(1)CA(1)CA(3)C(3)</span>
<a name="l00311"></a>00311 <span class="comment">//     call calc_dih_ang(bb_c1a1, bb_a1a2, bb_a2n2, delta(i+1))</span>
<a name="l00312"></a>00312      <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(bb_c1a1, bb_a1a2, bb_a2n2, &amp;<a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[i+1]);
<a name="l00313"></a>00313 <span class="comment">//     delta(i+1) = pi - delta(i+1)</span>
<a name="l00314"></a>00314      <a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[i+1] = <a class="code" href="POptimize_8h.html#c2b1cb8b3fb7713601463e82d1d2b627">pi</a> - <a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[i+1];
<a name="l00315"></a>00315    }
<a name="l00316"></a>00316 <span class="comment">//  end do</span>
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="comment">//  a_min = b_ang(4) - (xi(2) + eta(2))</span>
<a name="l00319"></a>00319   a_min = b_ang[3] - (<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[1] + <a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[1]);
<a name="l00320"></a>00320 <span class="comment">//  a_max = min(b_ang(4) + (xi(2) + eta(2)), pi)</span>
<a name="l00321"></a>00321   a_max = <a class="code" href="PTripepClosure_8h.html#9cc09fd5237e54feaa3e4cee4fedc869">min</a>((b_ang[3] + (<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[1] + <a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[1])), <a class="code" href="POptimize_8h.html#c2b1cb8b3fb7713601463e82d1d2b627">pi</a>);
<a name="l00322"></a>00322 
<a name="l00323"></a>00323 <span class="comment">//  ! min/max of base length</span>
<a name="l00325"></a>00325 <span class="comment"></span><span class="comment">//  printf("len1, len3= %9.5f %9.5f\n", len_aa[1], len_aa[2]);</span>
<a name="l00327"></a>00327 <span class="comment"></span><span class="comment">//  printf("a_min, a_max= %9.5f %9.5f\n", a_min*rad2deg, a_max*rad2deg);</span>
<a name="l00328"></a>00328 <span class="comment">//  aa13_min_sqr = len_aa(2)**2 + len_aa(3)**2 - 2.0d0*len_aa(2)*len_aa(3)*cos(a_min)</span>
<a name="l00329"></a>00329   <a class="code" href="PTripepClosure_8h.html#38fecdb3cdd8fee9b5fd20b3ffe3b8bc">aa13_min_sqr</a> = pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1],2) + pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[2],2) - 2.0e0*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1]*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[2]*cos(a_min);
<a name="l00330"></a>00330 <span class="comment">//  aa13_max_sqr = len_aa(2)**2 + len_aa(3)**2 - 2.0d0*len_aa(2)*len_aa(3)*cos(a_max)</span>
<a name="l00331"></a>00331   <a class="code" href="PTripepClosure_8h.html#302f95d1375aa6495c5fe9b293026258">aa13_max_sqr</a> = pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1],2) + pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[2],2) - 2.0e0*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1]*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[2]*cos(a_max);
<a name="l00333"></a>00333 <span class="comment">//  printf("aa13_min_sqr,aa13_max_sqr %9.5f %9.5f\n", aa13_min_sqr, aa13_max_sqr);</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="comment">//end subroutine initialize_loop_closure</span>
<a name="l00336"></a>00336  }
<a name="l00338"></a>00338 <span class="comment">//subroutine get_input_angles(n_soln, r_n1, r_a1, r_a3, r_c3)</span>
<a name="l00339"></a><a class="code" href="PTripepClosure_8h.html#4e7f0982e1205e03439e0801f493a198">00339</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#393b38594b0a27b92779acc32f39a62d">get_input_angles</a>(<span class="keywordtype">int</span> *n_soln, <span class="keywordtype">double</span> r_n1[3], <span class="keywordtype">double</span> r_a1[3], <span class="keywordtype">double</span> r_a3[3], <span class="keywordtype">double</span> r_c3[3])
<a name="l00340"></a>00340  {
<a name="l00344"></a>00344 <span class="comment">//  implicit none</span>
<a name="l00345"></a>00345 <span class="comment">//  real(dp), intent(in) :: r_n1(:), r_a1(:), r_a3(:), r_c3(:)</span>
<a name="l00346"></a>00346 <span class="comment">//  integer, intent(out) :: n_soln</span>
<a name="l00347"></a>00347 <span class="comment">//  real(dp) :: dr_sqr</span>
<a name="l00348"></a>00348   <span class="keywordtype">double</span> dr_sqr;
<a name="l00349"></a>00349   <span class="keywordtype">double</span> tmp_val[3];
<a name="l00350"></a>00350 <span class="comment">//  integer :: i</span>
<a name="l00351"></a>00351   <span class="keywordtype">int</span> i;
<a name="l00352"></a>00352 <span class="comment">//  character(len=2) :: cone_type</span>
<a name="l00353"></a>00353   <span class="keywordtype">char</span> cone_type[2];
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="comment">//  n_soln = max_soln</span>
<a name="l00357"></a>00357   *n_soln = <a class="code" href="PTripepClosure_8h.html#b30cbf883490b0afd792226d252e9e25">max_soln</a>;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="comment">//  ! vertual bond</span>
<a name="l00360"></a>00360 <span class="comment">//  r_a1a3(:) = r_a3(:) - r_a1(:) </span>
<a name="l00361"></a>00361   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00362"></a>00362     <a class="code" href="PTripepClosure_8h.html#3e4e1a078402f602dd214030aca2c1ab">r_a1a3</a>[i] = r_a3[i] - r_a1[i]; 
<a name="l00363"></a>00363 <span class="comment">//  dr_sqr = dot_product(r_a1a3,r_a1a3)</span>
<a name="l00364"></a>00364   dr_sqr = <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(<a class="code" href="PTripepClosure_8h.html#3e4e1a078402f602dd214030aca2c1ab">r_a1a3</a>,<a class="code" href="PTripepClosure_8h.html#3e4e1a078402f602dd214030aca2c1ab">r_a1a3</a>);
<a name="l00365"></a>00365 <span class="comment">//  len_aa(1) = sqrt(dr_sqr)</span>
<a name="l00366"></a>00366   <a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[0] = sqrt(dr_sqr);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">//  if (dr_sqr &lt; aa13_min_sqr .or. dr_sqr &gt; aa13_max_sqr) then</span>
<a name="l00369"></a>00369 <span class="comment">//     n_soln = 0</span>
<a name="l00372"></a>00372 <span class="comment"></span><span class="comment">//     return</span>
<a name="l00373"></a>00373 <span class="comment">//  end if</span>
<a name="l00374"></a>00374   <span class="keywordflow">if</span> ((dr_sqr &lt; <a class="code" href="PTripepClosure_8h.html#38fecdb3cdd8fee9b5fd20b3ffe3b8bc">aa13_min_sqr</a>) || (dr_sqr &gt; <a class="code" href="PTripepClosure_8h.html#302f95d1375aa6495c5fe9b293026258">aa13_max_sqr</a>))
<a name="l00375"></a>00375    {
<a name="l00376"></a>00376     *n_soln = 0;
<a name="l00377"></a>00377     <span class="keywordflow">return</span>;
<a name="l00378"></a>00378    }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="comment">//  ! bond lengths</span>
<a name="l00381"></a>00381 <span class="comment">//  r_a1n1(:) = r_n1(:) - r_a1(:)</span>
<a name="l00382"></a>00382   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00383"></a>00383     <a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>[i] = r_n1[i] - r_a1[i];
<a name="l00384"></a>00384 <span class="comment">//  len_na(1) = sqrt(dot_product(r_a1n1,r_a1n1))</span>
<a name="l00385"></a>00385   <a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[0] = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(<a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>,<a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>));
<a name="l00386"></a>00386 <span class="comment">//  len_na(2) = len0(3)</span>
<a name="l00387"></a>00387   <a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[1] = <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[2];
<a name="l00388"></a>00388 <span class="comment">//  len_na(3) = len0(6)</span>
<a name="l00389"></a>00389   <a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[2] = <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[5];
<a name="l00390"></a>00390 <span class="comment">//  r_a3c3(:) = r_c3(:) - r_a3(:)</span>
<a name="l00391"></a>00391   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00392"></a>00392     <a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">r_a3c3</a>[i] = r_c3[i] - r_a3[i];
<a name="l00393"></a>00393 <span class="comment">//  len_ac(1) = len0(1)</span>
<a name="l00394"></a>00394   <a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[0] = <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[0];
<a name="l00395"></a>00395 <span class="comment">//  len_ac(2) = len0(4)</span>
<a name="l00396"></a>00396   <a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[1] = <a class="code" href="PTripepClosure_8h.html#bf74e4d8d480ccff4116c668f7045000">len0</a>[3];
<a name="l00397"></a>00397 <span class="comment">//  len_ac(3) = sqrt(dot_product(r_a3c3,r_a3c3))</span>
<a name="l00398"></a>00398   <a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[2] = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(<a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">r_a3c3</a>,<a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">r_a3c3</a>));
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="comment">//  ! unit vectors</span>
<a name="l00401"></a>00401 <span class="comment">//  b_a1n1(:) = r_a1n1(:)/len_na(1)</span>
<a name="l00402"></a>00402 <span class="comment">//  b_a3c3(:) = r_a3c3(:)/len_ac(3)</span>
<a name="l00403"></a>00403 <span class="comment">//  b_a1a3(:) = r_a1a3(:)/len_aa(1)</span>
<a name="l00404"></a>00404   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00405"></a>00405    {
<a name="l00406"></a>00406     <a class="code" href="PTripepClosure_8h.html#87cb2c2c73dfaae6ee90bd3c10f795b4">b_a1n1</a>[i] = <a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>[i]/<a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[0];
<a name="l00407"></a>00407     <a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">b_a3c3</a>[i] = <a class="code" href="PTripepClosure_8h.html#766eed4f1ff2799450ec055edf928af5">r_a3c3</a>[i]/<a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[2];
<a name="l00408"></a>00408     <a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>[i] = <a class="code" href="PTripepClosure_8h.html#3e4e1a078402f602dd214030aca2c1ab">r_a1a3</a>[i]/<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[0];
<a name="l00409"></a>00409    }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">//  ! delta(3): dih of N(1)CA(1)CA(3)C(3)</span>
<a name="l00412"></a>00412 <span class="comment">//  call calc_dih_ang(-b_a1n1, b_a1a3, b_a3c3, delta(3))</span>
<a name="l00413"></a>00413   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00414"></a>00414     tmp_val[i] = -<a class="code" href="PTripepClosure_8h.html#87cb2c2c73dfaae6ee90bd3c10f795b4">b_a1n1</a>[i];
<a name="l00415"></a>00415   <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(tmp_val, <a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>, <a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">b_a3c3</a>, &amp;<a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[3]);
<a name="l00416"></a>00416 <span class="comment">//  delta(0) = delta(3)</span>
<a name="l00417"></a>00417   <a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[0] = <a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[3];
<a name="l00418"></a>00418 
<a name="l00419"></a>00419 <span class="comment">//  ! xi(1) </span>
<a name="l00420"></a>00420 <span class="comment">//  call calc_bnd_ang(-b_a1a3, b_a1n1, xi(1))</span>
<a name="l00421"></a>00421   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00422"></a>00422     tmp_val[i] = -<a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>[i];
<a name="l00423"></a>00423   <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(tmp_val, <a class="code" href="PTripepClosure_8h.html#87cb2c2c73dfaae6ee90bd3c10f795b4">b_a1n1</a>, &amp;<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[0]);
<a name="l00424"></a>00424  
<a name="l00425"></a>00425 <span class="comment">//  ! eta(3)</span>
<a name="l00426"></a>00426 <span class="comment">//  call calc_bnd_ang(b_a1a3, b_a3c3, eta(3))</span>
<a name="l00427"></a>00427   <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>, <a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">b_a3c3</a>, &amp;<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[2]);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429 <span class="comment">//  do i = 1, 3</span>
<a name="l00430"></a>00430   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00431"></a>00431    {
<a name="l00432"></a>00432 <span class="comment">//     cos_delta(i) = cos(delta(i))</span>
<a name="l00433"></a>00433      <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[i+1] = cos(<a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[i+1]);
<a name="l00434"></a>00434 <span class="comment">//     sin_delta(i) = sin(delta(i))</span>
<a name="l00435"></a>00435      <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[i+1] = sin(<a class="code" href="PTripepClosure_8h.html#24b6c4d609d47bf05c667a39b9e495b1">delta</a>[i+1]);
<a name="l00436"></a>00436 <span class="comment">//     cos_xi(i) = cos(xi(i))</span>
<a name="l00437"></a>00437 <span class="comment">//     cos_xi(i) = cos(xi(i))</span>
<a name="l00438"></a>00438      <a class="code" href="PTripepClosure_8h.html#8269e50c354358511ac656124788ceb1">cos_xi</a>[i] = cos(<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[i]);
<a name="l00439"></a>00439 <span class="comment">//     sin_xi(i) = sin(xi(i))</span>
<a name="l00440"></a>00440      <a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[i] = sin(<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[i]);
<a name="l00441"></a>00441 <span class="comment">//     sin_xi(i) = sin(xi(i))</span>
<a name="l00442"></a>00442      <a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[i] = sin(<a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[i]);
<a name="l00443"></a>00443 <span class="comment">//     cos_eta(i) = cos(eta(i))</span>
<a name="l00444"></a>00444      <a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[i] = cos(<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i]);
<a name="l00445"></a>00445 <span class="comment">//     cos_eta(i) = cos(eta(i))</span>
<a name="l00446"></a>00446      <a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[i] = cos(<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i]);
<a name="l00447"></a>00447 <span class="comment">//     sin_eta(i) = sin(eta(i))</span>
<a name="l00448"></a>00448      <a class="code" href="PTripepClosure_8h.html#d15cb2aaa72b0c7b5876072c271d9ff3">sin_eta</a>[i] = sin(<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i]);
<a name="l00449"></a>00449 <span class="comment">//     sin_eta(i) = sin(eta(i))</span>
<a name="l00450"></a>00450      <a class="code" href="PTripepClosure_8h.html#d15cb2aaa72b0c7b5876072c271d9ff3">sin_eta</a>[i] = sin(<a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i]);
<a name="l00451"></a>00451 <span class="comment">//  end do</span>
<a name="l00452"></a>00452    }
<a name="l00453"></a>00453 <span class="comment">//  cos_delta(0) = cos_delta(3)</span>
<a name="l00454"></a>00454   <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[0] = <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[3];
<a name="l00455"></a>00455 <span class="comment">//  sin_delta(0) = sin_delta(3)</span>
<a name="l00456"></a>00456   <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[0] = <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[3];
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="comment">//  ! theta (N, CA, C) bond angle</span>
<a name="l00459"></a>00459 <span class="comment">//  theta(1) = b_ang0(1)</span>
<a name="l00460"></a>00460   <a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[0] = <a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[0];
<a name="l00461"></a>00461 <span class="comment">//  theta(2) = b_ang0(4)</span>
<a name="l00462"></a>00462   <a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[1] = <a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[3];
<a name="l00463"></a>00463 <span class="comment">//  theta(3) = b_ang0(7)</span>
<a name="l00464"></a>00464   <a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[2] = <a class="code" href="PTripepClosure_8h.html#84f8709b71a55080bd41d3c29d635c3b">b_ang0</a>[6];
<a name="l00465"></a>00465 <span class="comment">//  do i = 1, 3</span>
<a name="l00466"></a>00466 <span class="comment">//     cos_theta(i) = cos(theta(i))</span>
<a name="l00467"></a>00467 <span class="comment">//  end do</span>
<a name="l00468"></a>00468   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00469"></a>00469     <a class="code" href="PTripepClosure_8h.html#11e189ba7a3eb629223eb7d37d0f335b">cos_theta</a>[i] = cos(<a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[i]);
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="comment">//  ! alpha </span>
<a name="l00472"></a>00472 <span class="comment">//  cos_alpha(1) = -(len_aa(1)**2 + len_aa(2)**2 - len_aa(3)**2)/(2.0d0*len_aa(1)*len_aa(2))</span>
<a name="l00473"></a>00473   <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[0] = -(pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[0],2) + pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1],2) - pow(<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[2],2))/(2.0e0*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[0]*<a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1]);
<a name="l00474"></a>00474 <span class="comment">//  alpha(1) = acos(cos_alpha(1))</span>
<a name="l00475"></a>00475   <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[0] = acos(<a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[0]);
<a name="l00476"></a>00476 <span class="comment">//  sin_alpha(1) = sin(alpha(1))</span>
<a name="l00477"></a>00477   <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[0] = sin(<a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[0]);
<a name="l00478"></a>00478 <span class="comment">//  cos_alpha(2) = (len_aa(2)**2 + len_aa(3)**2 - len_aa(1)**2)/(2.0d0*len_aa(2)*len_aa(3))</span>
<a name="l00479"></a>00479   <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[1] = (pow(len_aa[1],2) + pow(len_aa[2],2) - pow(len_aa[0],2))/(2.0e0*len_aa[1]*len_aa[2]);
<a name="l00480"></a>00480 <span class="comment">//  alpha(2) = acos(cos_alpha(2))</span>
<a name="l00481"></a>00481   <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[1] = acos(<a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[1]);
<a name="l00482"></a>00482 <span class="comment">//  sin_alpha(2) = sin(alpha(2))</span>
<a name="l00483"></a>00483   <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[1] = sin(<a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[1]);
<a name="l00484"></a>00484 <span class="comment">//  alpha(3) = pi - alpha(1) + alpha(2)</span>
<a name="l00485"></a>00485   <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[2] = <a class="code" href="POptimize_8h.html#c2b1cb8b3fb7713601463e82d1d2b627">pi</a> - <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[0] + <a class="code" href="PTripepClosure_8h.html#1678f99ec7081d4a0266124720898d46">alpha</a>[1];
<a name="l00486"></a>00486 <span class="comment">//  cos_alpha(3) = cos(alpha(3))</span>
<a name="l00487"></a>00487   <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[2] = cos(alpha[2]);
<a name="l00488"></a>00488 <span class="comment">//  sin_alpha(3) = sin(alpha(3))</span>
<a name="l00489"></a>00489   <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[2] = sin(alpha[2]);
<a name="l00490"></a>00490 <span class="comment">/*commmented out by Ankur Dhanik</span>
<a name="l00491"></a>00491 <span class="comment">//  if (print_level &gt; 0) then</span>
<a name="l00492"></a>00492 <span class="comment">  if (print_level &gt; 0)</span>
<a name="l00493"></a>00493 <span class="comment">   {</span>
<a name="l00494"></a>00494 <span class="comment">//     write(*,'(a,3f9.4)') 'xi = ', xi(1:3)*rad2deg</span>
<a name="l00495"></a>00495 <span class="comment">     printf("xi = %9.4f%9.4f%9.4f\n", xi[0]*rad2deg, xi[1]*rad2deg, xi[2]*rad2deg);</span>
<a name="l00496"></a>00496 <span class="comment">//     write(*,'(a,3f9.4)') 'eta = ', eta(1:3)*rad2deg</span>
<a name="l00497"></a>00497 <span class="comment">     printf("eta = %9.4f%9.4f%9.4f\n", eta[0]*rad2deg, eta[1]*rad2deg, eta[2]*rad2deg);</span>
<a name="l00498"></a>00498 <span class="comment">//     write(*,'(a,3f9.4)') 'delta = ', delta(1:3)*rad2deg</span>
<a name="l00499"></a>00499 <span class="comment">     printf("delta = %9.4f%9.4f%9.4f\n", delta[1]*rad2deg, delta[2]*rad2deg, delta[3]*rad2deg);</span>
<a name="l00500"></a>00500 <span class="comment">//     write(*,'(a,3f9.4)') 'theta = ', theta(1:3)*rad2deg</span>
<a name="l00501"></a>00501 <span class="comment">     printf("theta = %9.4f%9.4f%9.4f\n", theta[0]*rad2deg, theta[1]*rad2deg, theta[2]*rad2deg);</span>
<a name="l00502"></a>00502 <span class="comment">//     write(*,'(a,3f9.4)') 'alpha = ', alpha(1:3)*rad2deg</span>
<a name="l00503"></a>00503 <span class="comment">     printf("alpha = %9.4f%9.4f%9.4f\n", alpha[0]*rad2deg, alpha[1]*rad2deg, alpha[2]*rad2deg);</span>
<a name="l00504"></a>00504 <span class="comment">//  end if</span>
<a name="l00505"></a>00505 <span class="comment">   }</span>
<a name="l00506"></a>00506 <span class="comment">*/</span>
<a name="l00507"></a>00507 <span class="comment">//  ! check for existence of soln</span>
<a name="l00508"></a>00508 <span class="comment">//  do i = 1, 3</span>
<a name="l00509"></a>00509   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00510"></a>00510    {
<a name="l00511"></a>00511 <span class="comment">//     call test_two_cone_existence_soln(theta(i), xi(i), eta(i), alpha(i), &amp;</span>
<a name="l00512"></a>00512 <span class="comment">//          n_soln, cone_type)</span>
<a name="l00513"></a>00513     <a class="code" href="PTripepClosure_8h.html#12dc1b213051fb10d92488e781b855d6">test_two_cone_existence_soln</a>(<a class="code" href="PTripepClosure_8h.html#6d3c4970e07c7c109a5ca30d45e92cd9">theta</a>[i], <a class="code" href="PTripepClosure_8h.html#e91de5fac093f015e447f0426e2ef61a">xi</a>[i], <a class="code" href="PTripepClosure_8h.html#6e915f71d7a4a99196ddb0dee9a03e58">eta</a>[i], alpha[i], n_soln, cone_type);
<a name="l00514"></a>00514 <span class="comment">//     if (n_soln == 0) then</span>
<a name="l00515"></a>00515 <span class="comment">//        print*, 'return 1', i</span>
<a name="l00516"></a>00516 <span class="comment">//        return</span>
<a name="l00517"></a>00517 <span class="comment">//     end if</span>
<a name="l00518"></a>00518     <span class="keywordflow">if</span> (*n_soln == 0)
<a name="l00519"></a>00519       <span class="keywordflow">return</span>;
<a name="l00520"></a>00520 <span class="comment">//  end do</span>
<a name="l00521"></a>00521    }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="keywordflow">return</span>;
<a name="l00524"></a>00524 <span class="comment">//end subroutine get_input_angles</span>
<a name="l00525"></a>00525  }
<a name="l00527"></a>00527 <span class="comment">//subroutine test_two_cone_existence_soln(tt, kx, et, ap, n_soln, cone_type)</span>
<a name="l00528"></a><a class="code" href="PTripepClosure_8h.html#b532d8fcac1dc01fa22c5bf6d9e136de">00528</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#12dc1b213051fb10d92488e781b855d6">test_two_cone_existence_soln</a>(<span class="keywordtype">double</span> tt, <span class="keywordtype">double</span> kx, <span class="keywordtype">double</span> et, <span class="keywordtype">double</span> ap, <span class="keywordtype">int</span> *n_soln, <span class="keywordtype">char</span> cone_type[2])
<a name="l00529"></a>00529  {
<a name="l00530"></a>00530 <span class="comment">//  implicit none</span>
<a name="l00531"></a>00531 <span class="comment">//  real(dp), intent(in) :: tt, kx, et, ap</span>
<a name="l00532"></a>00532 <span class="comment">//  integer, intent(out) :: n_soln</span>
<a name="l00533"></a>00533 <span class="comment">//  character(len=2), intent(out) :: cone_type</span>
<a name="l00534"></a>00534 <span class="comment">//  character(len=2) :: case_type</span>
<a name="l00535"></a>00535 <span class="comment">//  real(dp) :: at, ex, abs_at, ap1, kx1, et1</span>
<a name="l00536"></a>00536   <span class="keywordtype">double</span> at, ex, abs_at, ap1, kx1, et1;
<a name="l00537"></a>00537 <span class="comment">//  real(dp) :: cos_tx1, cos_tx2, cos_te1, cos_te2, cos_ea1, cos_ea2, cos_xa1, cos_xa2</span>
<a name="l00538"></a>00538   <span class="keywordtype">double</span> cos_tx1, cos_tx2, cos_te1, cos_te2, cos_ea1, cos_ea2, cos_xa1, cos_xa2;
<a name="l00539"></a>00539 <span class="comment">//  logical :: s1, s2, t1, t2, complicated = .false.</span>
<a name="l00540"></a>00540   <span class="keywordtype">int</span> s1, s2, t1, t2;
<a name="l00541"></a>00541   <span class="keywordtype">int</span> complicated = 0;
<a name="l00542"></a>00542 <span class="comment">//  real(dp), parameter :: half_pi = 0.5d0*pi</span>
<a name="l00543"></a>00543 
<a name="l00544"></a>00544 <span class="comment">//  n_soln = max_soln</span>
<a name="l00545"></a>00545   *n_soln = <a class="code" href="PTripepClosure_8h.html#b30cbf883490b0afd792226d252e9e25">max_soln</a>;
<a name="l00546"></a>00546  
<a name="l00547"></a>00547 <span class="comment">//  ap1 = ap</span>
<a name="l00548"></a>00548   ap1 = ap;
<a name="l00549"></a>00549 <span class="comment">//  kx1 = kx</span>
<a name="l00550"></a>00550   kx1 = kx;
<a name="l00551"></a>00551 <span class="comment">//  et1 = et</span>
<a name="l00552"></a>00552   et1 = et;
<a name="l00553"></a>00553   
<a name="l00554"></a>00554 <span class="comment">//  at = ap1 - tt</span>
<a name="l00555"></a>00555   at = ap1 - tt;
<a name="l00556"></a>00556 <span class="comment">//  ex = kx1 + et1</span>
<a name="l00557"></a>00557   ex = kx1 + et1;
<a name="l00558"></a>00558 <span class="comment">//  abs_at = abs(at)</span>
<a name="l00559"></a>00559   abs_at = fabs(at);
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 <span class="comment">//  ! case of no soln</span>
<a name="l00562"></a>00562 <span class="comment">//  if (abs_at &gt; ex) then</span>
<a name="l00563"></a>00563 <span class="comment">//     n_soln = 0</span>
<a name="l00564"></a>00564 <span class="comment">//     return</span>
<a name="l00565"></a>00565 <span class="comment">//  end if</span>
<a name="l00566"></a>00566   <span class="keywordflow">if</span> (abs_at &gt; ex)
<a name="l00567"></a>00567    {
<a name="l00568"></a>00568     *n_soln = 0;
<a name="l00569"></a>00569     <span class="keywordflow">return</span>;
<a name="l00570"></a>00570    }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572 <span class="comment">//  if (complicated) then</span>
<a name="l00573"></a>00573 <span class="comment">//     ! find type of intersection</span>
<a name="l00574"></a>00574 <span class="comment">//     cos_tx1 = cos(tt+kx1)</span>
<a name="l00575"></a>00575 <span class="comment">//     cos_tx2 = cos(tt-kx1)</span>
<a name="l00576"></a>00576 <span class="comment">//     cos_te1 = cos(tt+et1)</span>
<a name="l00577"></a>00577 <span class="comment">//     cos_te2 = cos(tt-et1)</span>
<a name="l00578"></a>00578 <span class="comment">//     cos_ea1 = cos(et1+ap1)</span>
<a name="l00579"></a>00579 <span class="comment">//     cos_ea2 = cos(et1-ap1)</span>
<a name="l00580"></a>00580 <span class="comment">//     cos_xa1 = cos(kx1+ap1)</span>
<a name="l00581"></a>00581 <span class="comment">//     cos_xa2 = cos(kx1-ap1)</span>
<a name="l00582"></a>00582 <span class="comment">//     s1 = .false.; s2 = .false.; t1 = .false.; t2 = .false. </span>
<a name="l00583"></a>00583 <span class="comment">//     if ((cos_te1-cos_xa2)*(cos_te1-cos_xa1) &lt;= 0.0d0) s1 = .true.</span>
<a name="l00584"></a>00584 <span class="comment">//     if ((cos_te2-cos_xa2)*(cos_te2-cos_xa1) &lt;= 0.0d0) s2 = .true.</span>
<a name="l00585"></a>00585 <span class="comment">//     if ((cos_tx1-cos_ea2)*(cos_tx1-cos_ea1) &lt;= 0.0d0) t1 = .true.</span>
<a name="l00586"></a>00586 <span class="comment">//     if ((cos_tx2-cos_ea2)*(cos_tx2-cos_ea1) &lt;= 0.0d0) t2 = .true.</span>
<a name="l00587"></a>00587 <span class="comment">//  end if</span>
<a name="l00588"></a>00588   <span class="keywordflow">if</span> (complicated)
<a name="l00589"></a>00589    {
<a name="l00590"></a>00590 <span class="comment">//    cos_tx1 = cos(tt+kx1)</span>
<a name="l00591"></a>00591     cos_tx1 = cos(tt+kx1);
<a name="l00592"></a>00592 <span class="comment">//    cos_tx2 = cos(tt-kx1)</span>
<a name="l00593"></a>00593     cos_tx2 = cos(tt-kx1);
<a name="l00594"></a>00594 <span class="comment">//    cos_te1 = cos(tt+et1)</span>
<a name="l00595"></a>00595     cos_te1 = cos(tt+et1);
<a name="l00596"></a>00596 <span class="comment">//    cos_te2 = cos(tt-et1)</span>
<a name="l00597"></a>00597     cos_te2 = cos(tt-et1);
<a name="l00598"></a>00598 <span class="comment">//    cos_ea1 = cos(et1+ap1)</span>
<a name="l00599"></a>00599     cos_ea1 = cos(et1+ap1);
<a name="l00600"></a>00600 <span class="comment">//    cos_ea2 = cos(et1-ap1)</span>
<a name="l00601"></a>00601     cos_ea2 = cos(et1-ap1);
<a name="l00602"></a>00602 <span class="comment">//    cos_xa1 = cos(kx1+ap1)</span>
<a name="l00603"></a>00603     cos_xa1 = cos(kx1+ap1);
<a name="l00604"></a>00604 <span class="comment">//    cos_xa2 = cos(kx1-ap1)</span>
<a name="l00605"></a>00605     cos_xa2 = cos(kx1-ap1);
<a name="l00606"></a>00606 <span class="comment">//    s1 = .false.; s2 = .false.; t1 = .false.; t2 = .false. </span>
<a name="l00607"></a>00607     s1 = 0;
<a name="l00608"></a>00608     s2 = 0;
<a name="l00609"></a>00609     t1 = 0;
<a name="l00610"></a>00610     t2 = 0;
<a name="l00611"></a>00611 <span class="comment">//    if ((cos_te1-cos_xa2)*(cos_te1-cos_xa1) &lt;= 0.0d0) s1 = .true.</span>
<a name="l00612"></a>00612     <span class="keywordflow">if</span> ((cos_te1-cos_xa2)*(cos_te1-cos_xa1) &lt;= 0.0e0)
<a name="l00613"></a>00613       s1 = 0;
<a name="l00614"></a>00614 <span class="comment">//    if ((cos_te2-cos_xa2)*(cos_te2-cos_xa1) &lt;= 0.0d0) s2 = .true.</span>
<a name="l00615"></a>00615     <span class="keywordflow">if</span> ((cos_te2-cos_xa2)*(cos_te2-cos_xa1) &lt;= 0.0e0)
<a name="l00616"></a>00616       s2 = 0;
<a name="l00617"></a>00617 <span class="comment">//    if ((cos_tx1-cos_ea2)*(cos_tx1-cos_ea1) &lt;= 0.0d0) t1 = .true.</span>
<a name="l00618"></a>00618     <span class="keywordflow">if</span> ((cos_tx1-cos_ea2)*(cos_tx1-cos_ea1) &lt;= 0.0e0)
<a name="l00619"></a>00619       t1 = 0;
<a name="l00620"></a>00620 <span class="comment">//    if ((cos_tx2-cos_ea2)*(cos_tx2-cos_ea1) &lt;= 0.0d0) t2 = .true.</span>
<a name="l00621"></a>00621     <span class="keywordflow">if</span> ((cos_tx2-cos_ea2)*(cos_tx2-cos_ea1) &lt;= 0.0e0)
<a name="l00622"></a>00622       t2 = 0;
<a name="l00623"></a>00623    }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625   <span class="keywordflow">return</span>;
<a name="l00626"></a>00626 <span class="comment">//end subroutine test_two_cone_existence_soln</span>
<a name="l00627"></a>00627  }
<a name="l00629"></a>00629 <span class="comment">//subroutine get_poly_coeff(poly_coeff)</span>
<a name="l00630"></a><a class="code" href="PTripepClosure_8h.html#ffe1c9ec74382b7d5fa96076321d6ef9">00630</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#203eb9dfcc71e1ac2eb39d965ebe2534">get_poly_coeff</a>(<span class="keywordtype">double</span> poly_coeff[16+1])
<a name="l00631"></a>00631  {
<a name="l00632"></a>00632 <span class="comment">//  implicit none</span>
<a name="l00633"></a>00633 <span class="comment">//  real(dp), intent(out) :: poly_coeff(0:deg_pol)</span>
<a name="l00634"></a>00634 <span class="comment">//  integer :: i, j</span>
<a name="l00635"></a>00635   <span class="keywordtype">int</span> i, j;
<a name="l00636"></a>00636 <span class="comment">//  real(dp) :: A0, A1, A2, A3, A4, A21, A22, A31, A32, A41, A42</span>
<a name="l00637"></a>00637   <span class="keywordtype">double</span> A0, A1, A2, A3, A4, A21, A22, A31, A32, A41, A42;
<a name="l00638"></a>00638 <span class="comment">//  real(dp) :: B0(3), B1(3), B2(3), B3(3), B4(3), B5(3), B6(3), B7(3), B8(3)</span>
<a name="l00639"></a>00639   <span class="keywordtype">double</span> B0[3], B1[3], B2[3], B3[3], B4[3], B5[3], B6[3], B7[3], B8[3];
<a name="l00640"></a>00640 <span class="comment">//  real(dp), dimension(0:4,0:4) :: u11, u12, u13, u31, u32, u33</span>
<a name="l00641"></a>00641   <span class="keywordtype">double</span> u11[5][5], u12[5][5], u13[5][5], u31[5][5], u32[5][5], u33[5][5];
<a name="l00642"></a>00642 <span class="comment">//  real(dp), dimension(0:4,0:4) :: um1, um2, um3, um4, um5, um6, q_tmp</span>
<a name="l00643"></a>00643   <span class="keywordtype">double</span> um1[5][5], um2[5][5], um3[5][5], um4[5][5], um5[5][5], um6[5][5], q_tmp[5][5];
<a name="l00644"></a>00644 <span class="comment">//  integer, dimension(2) :: p1, p3, p_um1, p_um2, p_um3, p_um4, p_um5, p_um6, p_Q</span>
<a name="l00645"></a>00645   <span class="keywordtype">int</span> p1 [2], p3[2], p_um1[2], p_um2[2], p_um3[2], p_um4[2], p_um5[2], p_um6[2], p_Q[2];
<a name="l00646"></a>00646 <span class="comment">//  integer :: p2, p4, p_f1, p_f2, p_f3, p_f4, p_f5, p_f6, p_f7, &amp;</span>
<a name="l00647"></a>00647 <span class="comment">//       p_f8, p_f9, p_f10, p_f11, p_f12, p_f13, p_f14, p_f15, p_f16, p_f17, &amp;</span>
<a name="l00648"></a>00648 <span class="comment">//       p_f18, p_f19, p_f20, p_f21, p_f22, p_f23, p_f24, p_f25, p_f26, p_f27</span>
<a name="l00649"></a>00649   <span class="keywordtype">int</span> p2, p4, p_f1, p_f2, p_f3, p_f4, p_f5, p_f6, p_f7, p_f8, p_f9;
<a name="l00650"></a>00650   <span class="keywordtype">int</span> p_f10, p_f11, p_f12, p_f13, p_f14, p_f15, p_f16, p_f17, p_f18;
<a name="l00651"></a>00651   <span class="keywordtype">int</span> p_f19, p_f20, p_f21, p_f22, p_f23, p_f24, p_f25, p_f26;
<a name="l00652"></a>00652 <span class="comment">//  integer :: p_final</span>
<a name="l00653"></a>00653   <span class="keywordtype">int</span> p_final;
<a name="l00654"></a>00654 <span class="comment">//  real(dp), dimension(0:16) :: f1, f2, f3, f4, f5, f6, f7, f8, f9, f10, f11, &amp;</span>
<a name="l00655"></a>00655 <span class="comment">//       f12, f13, f14, f15, f16, f17, f18, f19, f20, f21, f22, f23, f24, f25, f26, f27</span>
<a name="l00656"></a>00656   <span class="keywordtype">double</span> f1[17], f2[17], f3[17], f4[17], f5[17], f6[17], f7[17], f8[17], f9[17];
<a name="l00657"></a>00657   <span class="keywordtype">double</span> f10[17], f11[17], f12[17], f13[17], f14[17], f15[17], f16[17], f17[17], f18[17];
<a name="l00658"></a>00658   <span class="keywordtype">double</span> f19[17], f20[17], f21[17], f22[17], f23[17], f24[17], f25[17], f26[17];
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="comment">//  ! A0, B0</span>
<a name="l00661"></a>00661 <span class="comment">//  do i = 1, 3</span>
<a name="l00662"></a>00662   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00663"></a>00663    {
<a name="l00664"></a>00664 <span class="comment">//     A0 = cos_alpha(i)*cos_xi(i)*cos_eta(i) - cos_theta(i)</span>
<a name="l00665"></a>00665     A0 = <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[i]*<a class="code" href="PTripepClosure_8h.html#8269e50c354358511ac656124788ceb1">cos_xi</a>[i]*<a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[i] - <a class="code" href="PTripepClosure_8h.html#11e189ba7a3eb629223eb7d37d0f335b">cos_theta</a>[i];
<a name="l00666"></a>00666 <span class="comment">//     A1 = -sin_alpha(i)*cos_xi(i)*sin_eta(i)</span>
<a name="l00667"></a>00667     A1 = -<a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[i]*<a class="code" href="PTripepClosure_8h.html#8269e50c354358511ac656124788ceb1">cos_xi</a>[i]*<a class="code" href="PTripepClosure_8h.html#d15cb2aaa72b0c7b5876072c271d9ff3">sin_eta</a>[i];
<a name="l00668"></a>00668 <span class="comment">//     A2 = sin_alpha(i)*sin_xi(i)*cos_eta(i)</span>
<a name="l00669"></a>00669     A2 = <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[i]*<a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[i]*<a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[i];
<a name="l00670"></a>00670 <span class="comment">//     A3 = sin_xi(i)*sin_eta(i)</span>
<a name="l00671"></a>00671     A3 = <a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[i]*sin_eta[i];
<a name="l00672"></a>00672 <span class="comment">//     A4 = A3*cos_alpha(i)</span>
<a name="l00673"></a>00673     A4 = A3*<a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[i];
<a name="l00674"></a>00674 <span class="comment">//     j = i - 1</span>
<a name="l00675"></a>00675     j = i;
<a name="l00676"></a>00676 <span class="comment">//     A21 = A2*cos_delta(j)</span>
<a name="l00677"></a>00677     A21 = A2*<a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[j];
<a name="l00678"></a>00678 <span class="comment">//     A22 = A2*sin_delta(j)</span>
<a name="l00679"></a>00679     A22 = A2*<a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[j];
<a name="l00680"></a>00680 <span class="comment">//     A31 = A3*cos_delta(j)</span>
<a name="l00681"></a>00681     A31 = A3*cos_delta[j];
<a name="l00682"></a>00682 <span class="comment">//     A32 = A3*sin_delta(j)</span>
<a name="l00683"></a>00683     A32 = A3*sin_delta[j];
<a name="l00684"></a>00684 <span class="comment">//     A41 = A4*cos_delta(j)</span>
<a name="l00685"></a>00685     A41 = A4*cos_delta[j];
<a name="l00686"></a>00686 <span class="comment">//     A42 = A4*sin_delta(j)</span>
<a name="l00687"></a>00687     A42 = A4*sin_delta[j];
<a name="l00688"></a>00688 <span class="comment">//     B0(i) = A0 + A22 + A31</span>
<a name="l00689"></a>00689     B0[i] = A0 + A22 + A31;
<a name="l00690"></a>00690 <span class="comment">//     B1(i) = 2.0d0*(A1 + A42)</span>
<a name="l00691"></a>00691     B1[i] = 2.0e0*(A1 + A42);
<a name="l00692"></a>00692 <span class="comment">//     B2(i) = 2.0d0*(A32 - A21)</span>
<a name="l00693"></a>00693     B2[i] = 2.0e0*(A32 - A21);
<a name="l00694"></a>00694 <span class="comment">//     B3(i) = -4.0d0*A41</span>
<a name="l00695"></a>00695     B3[i] = -4.0e0*A41;
<a name="l00696"></a>00696 <span class="comment">//     B4(i) = A0 + A22 - A31</span>
<a name="l00697"></a>00697     B4[i] = A0 + A22 - A31;
<a name="l00698"></a>00698 <span class="comment">//     B5(i) = A0 - A22 - A31</span>
<a name="l00699"></a>00699     B5[i] = A0 - A22 - A31;
<a name="l00700"></a>00700 <span class="comment">//     B6(i) = -2.0d0*(A21 + A32)</span>
<a name="l00701"></a>00701     B6[i] = -2.0e0*(A21 + A32);
<a name="l00702"></a>00702 <span class="comment">//     B7(i) = 2.0d0*(A1 - A42)</span>
<a name="l00703"></a>00703     B7[i] = 2.0e0*(A1 - A42);
<a name="l00704"></a>00704 <span class="comment">//     B8(i) = A0 - A22 + A31</span>
<a name="l00705"></a>00705     B8[i] = A0 - A22 + A31;
<a name="l00706"></a>00706 <span class="comment">//  end do</span>
<a name="l00707"></a>00707    }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">//  ! C0i</span>
<a name="l00710"></a>00710 <span class="comment">//  i = 1</span>
<a name="l00711"></a>00711   i = 0;
<a name="l00712"></a>00712 <span class="comment">//  C0(0:2,i) = (/ B0(i), B2(i), B5(i) /);</span>
<a name="l00713"></a>00713   <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][0] = B0[i];
<a name="l00714"></a>00714   <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][1] = B2[i];
<a name="l00715"></a>00715   <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][2] = B5[i];
<a name="l00716"></a>00716 <span class="comment">//  C1(0:2,i) = (/ B1(i), B3(i), B7(i) /);</span>
<a name="l00717"></a>00717   <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][0] = B1[i];
<a name="l00718"></a>00718   <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][1] = B3[i];
<a name="l00719"></a>00719   <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][2] = B7[i];
<a name="l00720"></a>00720 <span class="comment">//  C2(0:2,i) = (/ B4(i), B6(i), B8(i) /);</span>
<a name="l00721"></a>00721   <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][0] = B4[i];
<a name="l00722"></a>00722   <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][1] = B6[i];
<a name="l00723"></a>00723   <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][2] = B8[i];
<a name="l00724"></a>00724 <span class="comment">//  do i = 2, 3</span>
<a name="l00725"></a>00725   <span class="keywordflow">for</span>(i=1;i&lt;3;i++)
<a name="l00726"></a>00726    {
<a name="l00727"></a>00727 <span class="comment">//     C0(0:2,i) = (/ B0(i), B1(i), B4(i) /)</span>
<a name="l00728"></a>00728     <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][0] = B0[i];
<a name="l00729"></a>00729     <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][1] = B1[i];
<a name="l00730"></a>00730     <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[i][2] = B4[i];
<a name="l00731"></a>00731 <span class="comment">//     C1(0:2,i) = (/ B2(i), B3(i), B6(i) /)</span>
<a name="l00732"></a>00732     <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][0] = B2[i];
<a name="l00733"></a>00733     <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][1] = B3[i];
<a name="l00734"></a>00734     <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[i][2] = B6[i];
<a name="l00735"></a>00735 <span class="comment">//     C2(0:2,i) = (/ B5(i), B7(i), B8(i) /)</span>
<a name="l00736"></a>00736     <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][0] = B5[i];
<a name="l00737"></a>00737     <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][1] = B7[i];
<a name="l00738"></a>00738     <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[i][2] = B8[i];
<a name="l00739"></a>00739 <span class="comment">//  end do</span>
<a name="l00740"></a>00740    }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742 <span class="comment">//  ! first determinant</span>
<a name="l00743"></a>00743 <span class="comment">//  do i = 0, 2</span>
<a name="l00744"></a>00744   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00745"></a>00745    {
<a name="l00746"></a>00746 <span class="comment">//     u11(i,0) = C0(i,1)</span>
<a name="l00747"></a>00747      u11[0][i] = <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[0][i];
<a name="l00748"></a>00748 <span class="comment">//     u12(i,0) = C1(i,1)</span>
<a name="l00749"></a>00749      u12[0][i] = <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[0][i];
<a name="l00750"></a>00750 <span class="comment">//     u13(i,0) = C2(i,1)</span>
<a name="l00751"></a>00751      u13[0][i] = <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[0][i];
<a name="l00752"></a>00752 <span class="comment">//     u31(0,i) = C0(i,2) STRANGE !!!</span>
<a name="l00753"></a>00753      u31[i][0] = <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[1][i];
<a name="l00754"></a>00754 <span class="comment">//     u32(0,i) = C1(i,2) STRANGE !!!</span>
<a name="l00755"></a>00755      u32[i][0] = <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[1][i];
<a name="l00756"></a>00756 <span class="comment">//     u33(0,i) = C2(i,2) STRANGE !!!</span>
<a name="l00757"></a>00757      u33[i][0] = <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[1][i];
<a name="l00758"></a>00758 <span class="comment">//  end do</span>
<a name="l00759"></a>00759    }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 <span class="comment">//  p1(1:2) = (/ 2, 0 /)</span>
<a name="l00762"></a>00762   p1[0] = 2;
<a name="l00763"></a>00763   p1[1] = 0;
<a name="l00764"></a>00764 <span class="comment">//  p3(1:2) = (/ 0, 2 /)</span>
<a name="l00765"></a>00765   p3[0] = 0;
<a name="l00766"></a>00766   p3[1] = 2;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768 <span class="comment">//  call poly_mul_sub2(u32, u32, u31, u33, p3, p3, p3, p3, um1, p_um1)</span>
<a name="l00769"></a>00769   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u32, u32, u31, u33, p3, p3, p3, p3, um1, p_um1);
<a name="l00770"></a>00770 <span class="comment">//  call poly_mul_sub2(u12, u32, u11, u33, p1, p3, p1, p3, um2, p_um2)</span>
<a name="l00771"></a>00771   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u12, u32, u11, u33, p1, p3, p1, p3, um2, p_um2);
<a name="l00772"></a>00772 <span class="comment">//  call poly_mul_sub2(u12, u33, u13, u32, p1, p3, p1, p3, um3, p_um3)</span>
<a name="l00773"></a>00773   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u12, u33, u13, u32, p1, p3, p1, p3, um3, p_um3);
<a name="l00774"></a>00774 <span class="comment">//  call poly_mul_sub2(u11, u33, u31, u13, p1, p3, p3, p1, um4, p_um4)</span>
<a name="l00775"></a>00775   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u11, u33, u31, u13, p1, p3, p3, p1, um4, p_um4);
<a name="l00776"></a>00776 <span class="comment">//  call poly_mul_sub2(u13, um1, u33, um2, p1, p_um1, p3, p_um2, um5, p_um5)</span>
<a name="l00777"></a>00777   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u13, um1, u33, um2, p1, p_um1, p3, p_um2, um5, p_um5);
<a name="l00778"></a>00778 <span class="comment">//  call poly_mul_sub2(u13, um4, u12, um3, p1, p_um4, p1, p_um3, um6, p_um6)</span>
<a name="l00779"></a>00779   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u13, um4, u12, um3, p1, p_um4, p1, p_um3, um6, p_um6);
<a name="l00780"></a>00780 <span class="comment">//  call poly_mul_sub2(u11, um5, u31, um6, p1, p_um5, p3, p_um6, q_tmp, p_Q)</span>
<a name="l00781"></a>00781   <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(u11, um5, u31, um6, p1, p_um5, p3, p_um6, q_tmp, p_Q);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment">//  Q(0:4,0:4) = q_tmp(0:4,0:4)</span>
<a name="l00784"></a>00784   <span class="keywordflow">for</span>(i=0;i&lt;5;i++)
<a name="l00785"></a>00785     <span class="keywordflow">for</span>(j=0;j&lt;5;j++)
<a name="l00786"></a>00786       <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[i][j] = q_tmp[i][j];
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 <span class="comment">//  ! second determinant</span>
<a name="l00789"></a>00789 <span class="comment">//  R(:,:) = 0.0d0</span>
<a name="l00790"></a>00790   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00791"></a>00791     <span class="keywordflow">for</span>(j=0;j&lt;17;j++)
<a name="l00792"></a>00792       <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[i][j] = 0.;
<a name="l00793"></a>00793 <span class="comment">//  R(0:2,0) = C0(0:2,3)</span>
<a name="l00794"></a>00794 <span class="comment">//  R(0:2,1) = C1(0:2,3)</span>
<a name="l00795"></a>00795 <span class="comment">//  R(0:2,2) = C2(0:2,3)</span>
<a name="l00796"></a>00796   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l00797"></a>00797    {
<a name="l00798"></a>00798     <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0][i] = <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[2][i];
<a name="l00799"></a>00799     <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1][i] = <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[2][i];
<a name="l00800"></a>00800     <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2][i] = <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[2][i];
<a name="l00801"></a>00801    }
<a name="l00802"></a>00802 <span class="comment">//  p2 = 2</span>
<a name="l00803"></a>00803   p2 = 2;
<a name="l00804"></a>00804 <span class="comment">//  p4 = 4</span>
<a name="l00805"></a>00805   p4 = 4;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807 <span class="comment">//  call poly_mul_sub1(R(:,1), R(:,1), R(:,0), R(:,2), p2, p2, p2, p2, f1, p_f1)</span>
<a name="l00808"></a>00808   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], p2, p2, p2, p2, f1, &amp;p_f1);
<a name="l00809"></a>00809 <span class="comment">//  call poly_mul1(R(:,1), R(:,2), p2, p2, f2, p_f2)</span>
<a name="l00810"></a>00810   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], p2, p2, f2, &amp;p_f2);
<a name="l00811"></a>00811 <span class="comment">//  call poly_mul_sub1(R(:,1), f1, R(:,0), f2, p2, p_f1, p2, p_f2, f3, p_f3)</span>
<a name="l00812"></a>00812   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], f1, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f2, p2, p_f1, p2, p_f2, f3, &amp;p_f3);
<a name="l00813"></a>00813 <span class="comment">//  call poly_mul1(R(:,2), f1, p2, p_f1, f4, p_f4)</span>
<a name="l00814"></a>00814   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f1, p2, p_f1, f4, &amp;p_f4);
<a name="l00815"></a>00815 <span class="comment">//  call poly_mul_sub1(R(:,1), f3, R(:,0), f4, p2, p_f3, p2, p_f4, f5, p_f5)</span>
<a name="l00816"></a>00816   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], f3, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f4, p2, p_f3, p2, p_f4, f5, &amp;p_f5);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="comment">//  call poly_mul_sub1(Q(:,1), R(:,1), Q(:,0), R(:,2), p4, p2, p4, p2, f6, p_f6)</span>
<a name="l00819"></a>00819   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], p4, p2, p4, p2, f6, &amp;p_f6);
<a name="l00820"></a>00820 <span class="comment">//  call poly_mul_sub1(Q(:,2), f1, R(:,2), f6, p4, p_f1, p2, p_f6, f7, p_f7)</span>
<a name="l00821"></a>00821   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], f1, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f6, p4, p_f1, p2, p_f6, f7, &amp;p_f7);
<a name="l00822"></a>00822 <span class="comment">//  call poly_mul_sub1(Q(:,3), f3, R(:,2), f7, p4, p_f3, p2, p_f7, f8, p_f8)</span>
<a name="l00823"></a>00823   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], f3, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f7, p4, p_f3, p2, p_f7, f8, &amp;p_f8);
<a name="l00824"></a>00824 <span class="comment">//  call poly_mul_sub1(Q(:,4), f5, R(:,2), f8, p4, p_f5, p2, p_f8, f9, p_f9)</span>
<a name="l00825"></a>00825   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4], f5, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f8, p4, p_f5, p2, p_f8, f9, &amp;p_f9);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 <span class="comment">//  call poly_mul_sub1(Q(:,3), R(:,1), Q(:,4), R(:,0), p4, p2, p4, p2, f10, p_f10)</span>
<a name="l00828"></a>00828   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], p4, p2, p4, p2, f10, &amp;p_f10);
<a name="l00829"></a>00829 <span class="comment">//  call poly_mul_sub1(Q(:,2), f1, R(:,0), f10, p4, p_f1, p2, p_f10, f11, p_f11)</span>
<a name="l00830"></a>00830   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], f1, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f10, p4, p_f1, p2, p_f10, f11, &amp;p_f11);
<a name="l00831"></a>00831 <span class="comment">//  call poly_mul_sub1(Q(:,1), f3, R(:,0), f11, p4, p_f3, p2, p_f11, f12, p_f12)</span>
<a name="l00832"></a>00832   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], f3, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f11, p4, p_f3, p2, p_f11, f12, &amp;p_f12);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 <span class="comment">//  call poly_mul_sub1(Q(:,2), R(:,1), Q(:,1), R(:,2), p4, p2, p4, p2, f13, p_f13)</span>
<a name="l00835"></a>00835   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], p4, p2, p4, p2, f13, &amp;p_f13);
<a name="l00836"></a>00836 <span class="comment">//  call poly_mul_sub1(Q(:,3), f1, R(:,2), f13, p4, p_f1, p2, p_f13, f14, p_f14)</span>
<a name="l00837"></a>00837   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], f1, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f13, p4, p_f1, p2, p_f13, f14, &amp;p_f14);
<a name="l00838"></a>00838 <span class="comment">//  call poly_mul_sub1(Q(:,3), R(:,1), Q(:,2), R(:,2), p4, p2, p4, p2, f15, p_f15)</span>
<a name="l00839"></a>00839   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], p4, p2, p4, p2, f15, &amp;p_f15);
<a name="l00840"></a>00840 <span class="comment">//  call poly_mul_sub1(Q(:,4), f1, R(:,2), f15, p4, p_f1, p2, p_f15, f16, p_f16)</span>
<a name="l00841"></a>00841   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4], f1, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f15, p4, p_f1, p2, p_f15, f16, &amp;p_f16);
<a name="l00842"></a>00842 <span class="comment">//  call poly_mul_sub1(Q(:,1), f14, Q(:,0), f16, p4, p_f14, p4, p_f16, f17, p_f17)</span>
<a name="l00843"></a>00843   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], f14, <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0], f16, p4, p_f14, p4, p_f16, f17, &amp;p_f17);
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">//  call poly_mul_sub1(Q(:,2), R(:,2), Q(:,3), R(:,1), p4, p2, p4, p2, f18, p_f18)</span>
<a name="l00846"></a>00846   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], p4, p2, p4, p2, f18, &amp;p_f18);
<a name="l00847"></a>00847 <span class="comment">//  call poly_mul_sub1(Q(:,1), R(:,2), Q(:,3), R(:,0), p4, p2, p4, p2, f19, p_f19)</span>
<a name="l00848"></a>00848   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], p4, p2, p4, p2, f19, &amp;p_f19);
<a name="l00849"></a>00849 <span class="comment">//  call poly_mul_sub1(Q(:,3), f19, Q(:,2), f18, p4, p_f19, p4, p_f18, f20, p_f20)</span>
<a name="l00850"></a>00850   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3], f19, <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], f18, p4, p_f19, p4, p_f18, f20, &amp;p_f20);
<a name="l00851"></a>00851 <span class="comment">//  call poly_mul_sub1(Q(:,1), R(:,1), Q(:,2), R(:,0), p4, p2, p4, p2, f21, p_f21)</span>
<a name="l00852"></a>00852   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1], <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2], <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], p4, p2, p4, p2, f21, &amp;p_f21);
<a name="l00853"></a>00853 <span class="comment">//  call poly_mul1(Q(:,4), f21, p4, p_f21, f22, p_f22)</span>
<a name="l00854"></a>00854   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4], f21, p4, p_f21, f22, &amp;p_f22);
<a name="l00855"></a>00855 <span class="comment">//  call poly_sub1(f20, f22, p_f20, p_f22, f23, p_f23)</span>
<a name="l00856"></a>00856   <a class="code" href="PTripepClosure_8h.html#6924e4c0f28687ed25104959fb15463f">poly_sub1</a>(f20, f22, p_f20, p_f22, f23, &amp;p_f23);
<a name="l00857"></a>00857 <span class="comment">//  call poly_mul1(R(:,0), f23, p2, p_f23, f24, p_f24)</span>
<a name="l00858"></a>00858   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f23, p2, p_f23, f24, &amp;p_f24);
<a name="l00859"></a>00859 <span class="comment">//  call poly_sub1(f17, f24, p_f17, p_f24, f25, p_f25)</span>
<a name="l00860"></a>00860   <a class="code" href="PTripepClosure_8h.html#6924e4c0f28687ed25104959fb15463f">poly_sub1</a>(f17, f24, p_f17, p_f24, f25, &amp;p_f25);
<a name="l00861"></a>00861 <span class="comment">//  call poly_mul_sub1(Q(:,4), f12, R(:,2), f25, p4, p_f12, p2, p_f25, f26, p_f26)</span>
<a name="l00862"></a>00862   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4], f12, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2], f25, p4, p_f12, p2, p_f25, f26, &amp;p_f26);
<a name="l00863"></a>00863 <span class="comment">//  call poly_mul_sub1(Q(:,0), f9, R(:,0), f26, p4, p_f9, p2, p_f26, poly_coeff, p_final)</span>
<a name="l00864"></a>00864   <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0], f9, <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0], f26, p4, p_f9, p2, p_f26, poly_coeff, &amp;p_final);
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">//  if (p_final /= 16) then</span>
<a name="l00867"></a>00867 <span class="comment">//     print*, 'Error. Degree of polynomial is not 16!'</span>
<a name="l00868"></a>00868 <span class="comment">//     stop</span>
<a name="l00869"></a>00869 <span class="comment">//  end if</span>
<a name="l00870"></a>00870   <span class="keywordflow">if</span> (p_final != 16)
<a name="l00871"></a>00871    {
<a name="l00872"></a>00872     printf(<span class="stringliteral">"Error. Degree of polynomial is not 16!\n"</span>);
<a name="l00873"></a>00873     exit(1);
<a name="l00874"></a>00874    }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876 <span class="comment">//  if (poly_coeff(16) &lt; 0.0d0) then</span>
<a name="l00877"></a>00877 <span class="comment">//     poly_coeff(0:16) = -poly_coeff(0:16) </span>
<a name="l00878"></a>00878 <span class="comment">//  end if</span>
<a name="l00879"></a>00879   <span class="keywordflow">if</span> (poly_coeff[16] &lt; 0.0e0)
<a name="l00880"></a>00880     <span class="keywordflow">for</span>(i=0;i&lt;17;i++)
<a name="l00881"></a>00881      poly_coeff[i] *= -1.0; 
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">//  if (print_level &gt; 0) then</span>
<a name="l00884"></a>00884 <span class="comment">//     print*, 'poly_coeff'</span>
<a name="l00885"></a>00885 <span class="comment">//     do i = 0, 16</span>
<a name="l00886"></a>00886 <span class="comment">//        write(*,"(i5,e15.6)") i, poly_coeff(i)</span>
<a name="l00887"></a>00887 <span class="comment">//     end do</span>
<a name="l00888"></a>00888 <span class="comment">//  end if</span>
<a name="l00889"></a>00889 <span class="comment">/* commented out by Ankur Dhanik</span>
<a name="l00890"></a>00890 <span class="comment">  if (print_level &gt; 0)</span>
<a name="l00891"></a>00891 <span class="comment">   {</span>
<a name="l00892"></a>00892 <span class="comment">     printf("poly_coeff\n");</span>
<a name="l00893"></a>00893 <span class="comment">     for(i=0;i&lt;17;i++)</span>
<a name="l00894"></a>00894 <span class="comment">        printf("%5d%15.6f\n", i, poly_coeff[i]);</span>
<a name="l00895"></a>00895 <span class="comment">   }</span>
<a name="l00896"></a>00896 <span class="comment">*/</span>
<a name="l00897"></a>00897   <span class="keywordflow">return</span>;
<a name="l00898"></a>00898 <span class="comment">//end subroutine get_poly_coeff</span>
<a name="l00899"></a>00899  }
<a name="l00901"></a>00901 <span class="comment">//subroutine poly_mul_sub2(u1, u2, u3, u4, p1, p2, p3, p4, u5, p5)</span>
<a name="l00902"></a><a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">00902</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#f02e483f50044be8a8ac76ba41591d38">poly_mul_sub2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">double</span> u4[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">int</span> p3[2], <span class="keywordtype">int</span> p4[2], <span class="keywordtype">double</span> u5[5][5], <span class="keywordtype">int</span> p5[2])
<a name="l00903"></a>00903  {
<a name="l00904"></a>00904 <span class="comment">//  implicit none</span>
<a name="l00905"></a>00905 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(in) :: u1, u2, u3, u4</span>
<a name="l00906"></a>00906 <span class="comment">//  integer, dimension(2), intent(in) :: p1, p2, p3, p4</span>
<a name="l00907"></a>00907 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(out) :: u5</span>
<a name="l00908"></a>00908 <span class="comment">//  integer, dimension(2), intent(out) :: p5</span>
<a name="l00909"></a>00909 <span class="comment">//  real(dp), dimension(0:4,0:4) :: d1, d2</span>
<a name="l00910"></a>00910   <span class="keywordtype">double</span> d1[5][5], d2[5][5];
<a name="l00911"></a>00911 <span class="comment">//  integer, dimension(2) :: pd1, pd2</span>
<a name="l00912"></a>00912   <span class="keywordtype">int</span> pd1[2], pd2[2];
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="comment">//  call poly_mul2(u1, u2, p1, p2, d1, pd1)</span>
<a name="l00915"></a>00915   <a class="code" href="PTripepClosure_8h.html#d6da7cd180a9c4737224e61c88a33446">poly_mul2</a>(u1, u2, p1, p2, d1, pd1);
<a name="l00916"></a>00916 <span class="comment">//  call poly_mul2(u3, u4, p3, p4, d2, pd2)</span>
<a name="l00917"></a>00917   <a class="code" href="PTripepClosure_8h.html#d6da7cd180a9c4737224e61c88a33446">poly_mul2</a>(u3, u4, p3, p4, d2, pd2);
<a name="l00918"></a>00918 <span class="comment">//  call poly_sub2(d1, d2, pd1, pd2, u5, p5)</span>
<a name="l00919"></a>00919   <a class="code" href="PTripepClosure_8h.html#eefb1297cbb70b777cd9fba016c3b72e">poly_sub2</a>(d1, d2, pd1, pd2, u5, p5);
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 <span class="comment">//end subroutine poly_mul_sub2</span>
<a name="l00922"></a>00922  }
<a name="l00924"></a>00924 <span class="comment">//subroutine poly_mul2(u1, u2, p1, p2, u3, p3)</span>
<a name="l00925"></a><a class="code" href="PTripepClosure_8h.html#d6da7cd180a9c4737224e61c88a33446">00925</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#d6da7cd180a9c4737224e61c88a33446">poly_mul2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">int</span> p3[2])
<a name="l00926"></a>00926  {
<a name="l00927"></a>00927 <span class="comment">//  implicit none</span>
<a name="l00928"></a>00928 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(in) :: u1, u2</span>
<a name="l00929"></a>00929 <span class="comment">//  integer, dimension(2), intent(in) :: p1, p2</span>
<a name="l00930"></a>00930 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(out) :: u3</span>
<a name="l00931"></a>00931 <span class="comment">//  integer, intent(out) :: p3(2)</span>
<a name="l00932"></a>00932 <span class="comment">//  integer :: i1, j1, i2, j2, i3, j3, p11, p12, p21, p22</span>
<a name="l00933"></a>00933   <span class="keywordtype">int</span> i1, j1, i2, j2, i3, j3, p11, p12, p21, p22;
<a name="l00934"></a>00934   <span class="keywordtype">int</span> i, j;
<a name="l00935"></a>00935 <span class="comment">//  real(dp) :: u1ij</span>
<a name="l00936"></a>00936   <span class="keywordtype">double</span> u1ij;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="comment">//  p3(:) = p1(:) + p2(:)</span>
<a name="l00939"></a>00939   <span class="keywordflow">for</span>(i=0;i&lt;2;i++)
<a name="l00940"></a>00940     p3[i] = p1[i] + p2[i];
<a name="l00941"></a>00941   <span class="keywordflow">for</span>(i=0;i&lt;5;i++)
<a name="l00942"></a>00942     <span class="keywordflow">for</span>(j=0;j&lt;5;j++)
<a name="l00943"></a>00943       u3[i][j] = 0.0e0;
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 <span class="comment">//  p11 = p1(1)</span>
<a name="l00946"></a>00946   p11 = p1[0];
<a name="l00947"></a>00947 <span class="comment">//  p12 = p1(2)</span>
<a name="l00948"></a>00948   p12 = p1[1];
<a name="l00949"></a>00949 <span class="comment">//  p21 = p2(1)</span>
<a name="l00950"></a>00950   p21 = p2[0];
<a name="l00951"></a>00951 <span class="comment">//  p22 = p2(2)</span>
<a name="l00952"></a>00952   p22 = p2[1];
<a name="l00953"></a>00953 
<a name="l00954"></a>00954 <span class="comment">//  do i1 = 0, p12</span>
<a name="l00955"></a>00955   <span class="keywordflow">for</span>(i1=0;i1&lt;=p12;i1++)
<a name="l00956"></a>00956    {
<a name="l00957"></a>00957 <span class="comment">//     do j1 = 0, p11</span>
<a name="l00958"></a>00958      <span class="keywordflow">for</span>(j1=0;j1&lt;=p11;j1++)
<a name="l00959"></a>00959       {
<a name="l00960"></a>00960 <span class="comment">//        u1ij = u1(j1,i1)</span>
<a name="l00961"></a>00961         u1ij = u1[i1][j1];
<a name="l00962"></a>00962 <span class="comment">//        do i2 = 0, p22</span>
<a name="l00963"></a>00963         <span class="keywordflow">for</span>(i2=0;i2&lt;=p22;i2++)
<a name="l00964"></a>00964          {
<a name="l00965"></a>00965 <span class="comment">//           i3 = i1 + i2</span>
<a name="l00966"></a>00966            i3 = i1 + i2;
<a name="l00967"></a>00967 <span class="comment">//           do j2 = 0, p21</span>
<a name="l00968"></a>00968            <span class="keywordflow">for</span> (j2=0;j2&lt;=p21;j2++)
<a name="l00969"></a>00969             {
<a name="l00970"></a>00970 <span class="comment">//              j3 = j1 + j2</span>
<a name="l00971"></a>00971               j3 = j1 + j2;
<a name="l00972"></a>00972 <span class="comment">//              u3(j3,i3) = u3(j3,i3) + u1ij*u2(j2,i2)</span>
<a name="l00973"></a>00973               u3[i3][j3] = u3[i3][j3] + u1ij*u2[i2][j2];
<a name="l00974"></a>00974 <span class="comment">//           end do</span>
<a name="l00975"></a>00975             }
<a name="l00976"></a>00976 <span class="comment">//        end do</span>
<a name="l00977"></a>00977          }
<a name="l00978"></a>00978 <span class="comment">//     end do</span>
<a name="l00979"></a>00979       }
<a name="l00980"></a>00980 <span class="comment">//  end do</span>
<a name="l00981"></a>00981    }
<a name="l00982"></a>00982 
<a name="l00983"></a>00983 <span class="comment">//end subroutine poly_mul2</span>
<a name="l00984"></a>00984  }
<a name="l00986"></a>00986 <span class="comment">//subroutine poly_sub2(u1, u2, p1, p2, u3, p3)</span>
<a name="l00987"></a><a class="code" href="PTripepClosure_8h.html#eefb1297cbb70b777cd9fba016c3b72e">00987</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#eefb1297cbb70b777cd9fba016c3b72e">poly_sub2</a>(<span class="keywordtype">double</span> u1[5][5], <span class="keywordtype">double</span> u2[5][5], <span class="keywordtype">int</span> p1[2], <span class="keywordtype">int</span> p2[2], <span class="keywordtype">double</span> u3[5][5], <span class="keywordtype">int</span> p3[2])
<a name="l00988"></a>00988  {
<a name="l00989"></a>00989 <span class="comment">//  implicit none</span>
<a name="l00990"></a>00990 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(in) :: u1, u2</span>
<a name="l00991"></a>00991 <span class="comment">//  integer, intent(in) :: p1(2), p2(2)</span>
<a name="l00992"></a>00992 <span class="comment">//  real(dp), dimension(0:4,0:4), intent(out) :: u3</span>
<a name="l00993"></a>00993 <span class="comment">//  integer, intent(out) :: p3(2)</span>
<a name="l00994"></a>00994 <span class="comment">//  integer :: i, j, p11, p12, p21, p22</span>
<a name="l00995"></a>00995   <span class="keywordtype">int</span> i, j, p11, p12, p21, p22;
<a name="l00996"></a>00996 <span class="comment">//  logical :: i1_ok, i2_ok</span>
<a name="l00997"></a>00997   <span class="keywordtype">int</span> i1_ok, i2_ok;
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="comment">//  p11 = p1(1)</span>
<a name="l01000"></a>01000   p11 = p1[0];
<a name="l01001"></a>01001 <span class="comment">//  p12 = p1(2)</span>
<a name="l01002"></a>01002   p12 = p1[1];
<a name="l01003"></a>01003 <span class="comment">//  p21 = p2(1)</span>
<a name="l01004"></a>01004   p21 = p2[0];
<a name="l01005"></a>01005 <span class="comment">//  p22 = p2(2)</span>
<a name="l01006"></a>01006   p22 = p2[1];
<a name="l01007"></a>01007 <span class="comment">//  p3(1) = max(p11,p21)</span>
<a name="l01008"></a>01008   p3[0] = <a class="code" href="PTripepClosure_8h.html#ba9726df73d617ec0e6116d8a1b81050">max</a>(p11,p21);
<a name="l01009"></a>01009 <span class="comment">//  p3(2) = max(p12,p22)</span>
<a name="l01010"></a>01010   p3[1] = <a class="code" href="PTripepClosure_8h.html#ba9726df73d617ec0e6116d8a1b81050">max</a>(p12,p22);
<a name="l01011"></a>01011 
<a name="l01012"></a>01012 <span class="comment">//  do i = 0, p3(2)</span>
<a name="l01013"></a>01013   <span class="keywordflow">for</span>(i=0;i&lt;=p3[1];i++)
<a name="l01014"></a>01014    {
<a name="l01015"></a>01015 <span class="comment">//     i1_ok = (i &gt; p12)</span>
<a name="l01016"></a>01016     i1_ok = (i &gt; p12);
<a name="l01017"></a>01017 <span class="comment">//     i2_ok = (i &gt; p22)</span>
<a name="l01018"></a>01018     i2_ok = (i &gt; p22);
<a name="l01019"></a>01019 <span class="comment">//     do j = 0, p3(1)</span>
<a name="l01020"></a>01020     <span class="keywordflow">for</span>(j=0;j&lt;=p3[0];j++)
<a name="l01021"></a>01021      {
<a name="l01022"></a>01022 <span class="comment">//        if (i2_ok .or. (j &gt; p21)) then</span>
<a name="l01023"></a>01023 <span class="comment">//           u3(j,i) = u1(j,i)</span>
<a name="l01024"></a>01024       <span class="keywordflow">if</span> (i2_ok || (j &gt; p21))
<a name="l01025"></a>01025         u3[i][j] = u1[i][j];
<a name="l01026"></a>01026 <span class="comment">//        else if (i1_ok .or. (j &gt; p11)) then</span>
<a name="l01027"></a>01027 <span class="comment">//           u3(j,i) = -u2(j,i)</span>
<a name="l01028"></a>01028       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i1_ok || (j &gt; p11))
<a name="l01029"></a>01029         u3[i][j] = -u2[i][j];
<a name="l01030"></a>01030 <span class="comment">//        else</span>
<a name="l01031"></a>01031 <span class="comment">//           u3(j,i) = u1(j,i) - u2(j,i)</span>
<a name="l01032"></a>01032       <span class="keywordflow">else</span>
<a name="l01033"></a>01033         u3[i][j] = u1[i][j] - u2[i][j];
<a name="l01034"></a>01034 <span class="comment">//        end if</span>
<a name="l01035"></a>01035 <span class="comment">//     end do</span>
<a name="l01036"></a>01036      }
<a name="l01037"></a>01037 <span class="comment">//  end do</span>
<a name="l01038"></a>01038    }
<a name="l01039"></a>01039 
<a name="l01040"></a>01040   <span class="keywordflow">return</span>;
<a name="l01041"></a>01041 <span class="comment">//end subroutine poly_sub2</span>
<a name="l01042"></a>01042  }
<a name="l01044"></a>01044 <span class="comment">//subroutine poly_mul_sub1(u1, u2, u3, u4, p1, p2, p3, p4, u5, p5)</span>
<a name="l01045"></a><a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">01045</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#63ea6c502267c97b1a85bde5d72af6e2">poly_mul_sub1</a>(<span class="keywordtype">double</span> u1[17], <span class="keywordtype">double</span> u2[17], <span class="keywordtype">double</span> u3[17], <span class="keywordtype">double</span> u4[17], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">int</span> p3, <span class="keywordtype">int</span> p4, <span class="keywordtype">double</span> u5[17], <span class="keywordtype">int</span> *p5)
<a name="l01046"></a>01046  {
<a name="l01047"></a>01047 <span class="comment">//  implicit none</span>
<a name="l01048"></a>01048 <span class="comment">//  real(dp), dimension(0:16), intent(in) :: u1, u2, u3, u4</span>
<a name="l01049"></a>01049 <span class="comment">//  integer, intent(in) :: p1, p2, p3, p4</span>
<a name="l01050"></a>01050 <span class="comment">//  real(dp), dimension(0:16), intent(out) :: u5</span>
<a name="l01051"></a>01051 <span class="comment">//  integer, intent(out) :: p5</span>
<a name="l01052"></a>01052 <span class="comment">//  real(dp), dimension(0:16) :: d1, d2</span>
<a name="l01053"></a>01053   <span class="keywordtype">double</span> d1[17], d2[17];
<a name="l01054"></a>01054 <span class="comment">//  integer :: pd1, pd2</span>
<a name="l01055"></a>01055   <span class="keywordtype">int</span> pd1, pd2;
<a name="l01056"></a>01056 
<a name="l01057"></a>01057 <span class="comment">//  call poly_mul1(u1, u2, p1, p2, d1, pd1)</span>
<a name="l01058"></a>01058   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(u1, u2, p1, p2, d1, &amp;pd1);
<a name="l01059"></a>01059 <span class="comment">//  call poly_mul1(u3, u4, p3, p4, d2, pd2)</span>
<a name="l01060"></a>01060   <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(u3, u4, p3, p4, d2, &amp;pd2);
<a name="l01061"></a>01061 <span class="comment">//  call poly_sub1(d1, d2, pd1, pd2, u5, p5)</span>
<a name="l01062"></a>01062   <a class="code" href="PTripepClosure_8h.html#6924e4c0f28687ed25104959fb15463f">poly_sub1</a>(d1, d2, pd1, pd2, u5, p5);
<a name="l01063"></a>01063 
<a name="l01064"></a>01064   <span class="keywordflow">return</span>;
<a name="l01065"></a>01065 <span class="comment">//end subroutine poly_mul_sub1</span>
<a name="l01066"></a>01066  }
<a name="l01068"></a>01068 <span class="comment">//subroutine poly_mul1(u1, u2, p1, p2, u3, p3)</span>
<a name="l01069"></a><a class="code" href="PTripepClosure_8h.html#1834a14ba66ff08b7117be8e73da7d68">01069</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#093b9e305c3f4fe1b9e969d08212e74f">poly_mul1</a>(<span class="keywordtype">double</span> u1[17], <span class="keywordtype">double</span> u2[17], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">double</span> u3[17], <span class="keywordtype">int</span> *p3)
<a name="l01070"></a>01070  {
<a name="l01071"></a>01071 <span class="comment">//  implicit none</span>
<a name="l01072"></a>01072 <span class="comment">//  real(dp), dimension(0:16), intent(in) :: u1, u2</span>
<a name="l01073"></a>01073 <span class="comment">//  integer, intent(in) :: p1, p2</span>
<a name="l01074"></a>01074 <span class="comment">//  real(dp), dimension(0:16), intent(out) :: u3</span>
<a name="l01075"></a>01075 <span class="comment">//  integer, intent(out) :: p3</span>
<a name="l01076"></a>01076 <span class="comment">//  integer :: i1, i2, i3</span>
<a name="l01077"></a>01077   <span class="keywordtype">int</span> i, i1, i2, i3;
<a name="l01078"></a>01078 <span class="comment">//  real(dp) :: u1i</span>
<a name="l01079"></a>01079   <span class="keywordtype">double</span> u1i;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">//  p3 = p1 + p2</span>
<a name="l01082"></a>01082   *p3 = p1 + p2;
<a name="l01083"></a>01083 <span class="comment">//  u3(:) = 0.0d0</span>
<a name="l01084"></a>01084   <span class="keywordflow">for</span>(i=0;i&lt;17;i++)
<a name="l01085"></a>01085     u3[i] = 0.;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087 <span class="comment">//  do i1 = 0, p1</span>
<a name="l01088"></a>01088   <span class="keywordflow">for</span>(i1=0;i1&lt;=p1;i1++)
<a name="l01089"></a>01089    {
<a name="l01090"></a>01090 <span class="comment">//     u1i = u1(i1)</span>
<a name="l01091"></a>01091     u1i = u1[i1];
<a name="l01092"></a>01092 <span class="comment">//     do i2 = 0, p2</span>
<a name="l01093"></a>01093     <span class="keywordflow">for</span>(i2=0;i2&lt;=p2;i2++)
<a name="l01094"></a>01094      {
<a name="l01095"></a>01095 <span class="comment">//        i3 = i1 + i2</span>
<a name="l01096"></a>01096         i3 = i1 + i2;
<a name="l01097"></a>01097 <span class="comment">//        u3(i3) = u3(i3) + u1i*u2(i2)</span>
<a name="l01098"></a>01098         u3[i3] = u3[i3] + u1i*u2[i2];
<a name="l01099"></a>01099 <span class="comment">//     end do</span>
<a name="l01100"></a>01100      }
<a name="l01101"></a>01101 <span class="comment">//  end do</span>
<a name="l01102"></a>01102    }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104   <span class="keywordflow">return</span>;
<a name="l01105"></a>01105 <span class="comment">//end subroutine poly_mul1</span>
<a name="l01106"></a>01106  }
<a name="l01108"></a>01108 <span class="comment">//subroutine poly_sub1(u1, u2, p1, p2, u3, p3)</span>
<a name="l01109"></a><a class="code" href="PTripepClosure_8h.html#fd398c73590674838f63fa3ae71ef713">01109</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#6924e4c0f28687ed25104959fb15463f">poly_sub1</a>(<span class="keywordtype">double</span> u1[17], <span class="keywordtype">double</span> u2[17], <span class="keywordtype">int</span> p1, <span class="keywordtype">int</span> p2, <span class="keywordtype">double</span> u3[17], <span class="keywordtype">int</span> *p3)
<a name="l01110"></a>01110  {
<a name="l01111"></a>01111 <span class="comment">//  implicit none</span>
<a name="l01112"></a>01112 <span class="comment">//  real(dp), dimension(0:16), intent(in) :: u1, u2</span>
<a name="l01113"></a>01113 <span class="comment">//  integer, intent(in) :: p1, p2</span>
<a name="l01114"></a>01114 <span class="comment">//  real(dp), dimension(0:16), intent(out) :: u3</span>
<a name="l01115"></a>01115 <span class="comment">//  integer, intent(out) :: p3</span>
<a name="l01116"></a>01116 <span class="comment">//  integer :: i</span>
<a name="l01117"></a>01117   <span class="keywordtype">int</span> i;
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="comment">//  p3 = max(p1, p2)</span>
<a name="l01120"></a>01120   *p3 = <a class="code" href="PTripepClosure_8h.html#ba9726df73d617ec0e6116d8a1b81050">max</a>(p1, p2);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122 <span class="comment">//  do i = 0, p3</span>
<a name="l01123"></a>01123   <span class="keywordflow">for</span>(i=0;i&lt;=*p3;i++)
<a name="l01124"></a>01124    {
<a name="l01125"></a>01125 <span class="comment">//     if (i &gt; p2) then</span>
<a name="l01126"></a>01126 <span class="comment">//        u3(i) = u1(i)</span>
<a name="l01127"></a>01127     <span class="keywordflow">if</span> (i &gt; p2)
<a name="l01128"></a>01128       u3[i] = u1[i];
<a name="l01129"></a>01129 <span class="comment">//     else if (i &gt; p1) then</span>
<a name="l01130"></a>01130 <span class="comment">//        u3(i) = -u2(i)</span>
<a name="l01131"></a>01131     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &gt; p1)
<a name="l01132"></a>01132       u3[i] = -u2[i];
<a name="l01133"></a>01133 <span class="comment">//     else</span>
<a name="l01134"></a>01134 <span class="comment">//        u3(i) = u1(i) - u2(i)</span>
<a name="l01135"></a>01135     <span class="keywordflow">else</span>
<a name="l01136"></a>01136       u3[i] = u1[i] - u2[i];
<a name="l01137"></a>01137 <span class="comment">//     end if</span>
<a name="l01138"></a>01138 <span class="comment">//  end do</span>
<a name="l01139"></a>01139    }
<a name="l01140"></a>01140 
<a name="l01141"></a>01141   <span class="keywordflow">return</span>;
<a name="l01142"></a>01142 <span class="comment">//end subroutine poly_sub1</span>
<a name="l01143"></a>01143  }
<a name="l01145"></a>01145 <span class="comment">//subroutine coord_from_poly_roots(n_soln, roots, r_n1, r_a1, r_a3, r_c3, r_soln_n, r_soln_a, r_soln_c)</span>
<a name="l01146"></a><a class="code" href="PTripepClosure_8h.html#f44b3a456561aff184243204d214e0ea">01146</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#f44b3a456561aff184243204d214e0ea">coord_from_poly_roots</a>(<span class="keywordtype">int</span> *n_soln, <span class="keywordtype">double</span> roots[16], <span class="keywordtype">double</span> r_n1[3], <span class="keywordtype">double</span> r_a1[3], <span class="keywordtype">double</span> r_a3[3], <span class="keywordtype">double</span> r_c3[3], <span class="keywordtype">double</span> r_soln_n[16][3][3], <span class="keywordtype">double</span> r_soln_a[16][3][3], <span class="keywordtype">double</span> r_soln_c[16][3][3])
<a name="l01147"></a>01147 {
<a name="l01148"></a>01148 <span class="comment">//  implicit none</span>
<a name="l01149"></a>01149 <span class="comment">//  integer, intent(in) :: n_soln</span>
<a name="l01150"></a>01150 <span class="comment">//  real(dp), intent(in) :: r_n1(:), r_a1(:), r_a3(:), r_c3(:), roots(n_soln)</span>
<a name="l01151"></a>01151 <span class="comment">//  real(dp), intent(out) :: r_soln_n(:,:,:), r_soln_a(:,:,:), r_soln_c(:,:,:)</span>
<a name="l01152"></a>01152 <span class="comment">//  real(dp) :: ex(3), ey(3), ez(3), b_a1a2(3), b_a3a2(3), r_tmp(3)</span>
<a name="l01153"></a>01153   <span class="keywordtype">double</span> ex[3], ey[3], ez[3], b_a1a2[3], b_a3a2[3], r_tmp[3];
<a name="l01154"></a>01154 <span class="comment">//  real(dp) :: p_s(3,3), s1(3,3), s2(3,3), p_t(3,3), t1(3,3), t2(3,3)</span>
<a name="l01155"></a>01155   <span class="keywordtype">double</span> p_s[3][3], s1[3][3], s2[3][3], p_t[3][3], t1[3][3], t2[3][3];
<a name="l01156"></a>01156 <span class="comment">//  real(dp) :: p_s_c(3,3), s1_s(3,3), s2_s(3,3), p_t_c(3,3), t1_s(3,3), t2_s(3,3)</span>
<a name="l01157"></a>01157   <span class="keywordtype">double</span> p_s_c[3][3], s1_s[3][3], s2_s[3][3], p_t_c[3][3], t1_s[3][3], t2_s[3][3];
<a name="l01158"></a>01158 <span class="comment">//  real(dp) :: angle, sig1_init, half_tan(3)</span>
<a name="l01159"></a>01159   <span class="keywordtype">double</span> angle, sig1_init, half_tan[3];
<a name="l01160"></a>01160 <span class="comment">//  real(dp) :: cos_tau(0:3), sin_tau(0:3), cos_sig(3), sin_sig(3), ht, tmp, sig1</span>
<a name="l01161"></a>01161   <span class="keywordtype">double</span> cos_tau[4], sin_tau[4], cos_sig[3], sin_sig[3], ht, tmp, sig1;
<a name="l01162"></a>01162 <span class="comment">//  real(dp) :: r_s(3), r_t(3), r0(3), r_n(3,3), r_a(3,3), r_c(3,3), p(4), Us(3,3)</span>
<a name="l01163"></a>01163   <span class="keywordtype">double</span> r_s[3], r_t[3], r0[3], r_n[3][3], r_a[3][3], r_c[3][3], <a class="code" href="structp.html">p</a>[4], Us[3][3];
<a name="l01164"></a>01164 <span class="comment">//  integer :: i_soln, i, j</span>
<a name="l01165"></a>01165   <span class="keywordtype">int</span> i_soln, i, j;
<a name="l01166"></a>01166 <span class="comment">//  real(dp) :: a1c1, c1n2, n2a2, a2c2, c2n3, n3a3, a1a2, a2a3</span>
<a name="l01167"></a>01167   <span class="keywordtype">double</span> a1c1, c1n2, n2a2, a2c2, c2n3, n3a3, a1a2, a2a3;
<a name="l01168"></a>01168 <span class="comment">//  real(dp) :: rr_a1c1(3), rr_c1n2(3), rr_n2a2(3), rr_a2c2(3), rr_c2n3(3), rr_n3a3(3), rr_a1a2(3), rr_a2a3(3)</span>
<a name="l01169"></a>01169   <span class="keywordtype">double</span> rr_a1c1[3], rr_c1n2[3], rr_n2a2[3], rr_a2c2[3], rr_c2n3[3], rr_n3a3[3], rr_a1a2[3], rr_a2a3[3];
<a name="l01170"></a>01170 <span class="comment">//  real(dp) :: a3a1a2, a2a3a1, n1a1c1, n2a2c2, n3a3c3, a1c1n2a2, a2c2n3a3</span>
<a name="l01171"></a>01171   <span class="keywordtype">double</span> a3a1a2, a2a3a1, n1a1c1, n2a2c2, n3a3c3, a1c1n2a2, a2c2n3a3;
<a name="l01172"></a>01172   <span class="keywordtype">double</span> tmp_value, ex_tmp[3];
<a name="l01173"></a>01173   <span class="keywordtype">double</span> tmp_array[3], tmp_array1[3], tmp_array2[3], tmp_array3[3];
<a name="l01174"></a>01174   <span class="keywordtype">double</span> mat1[3], mat2[3], mat3[3], mat4[3], mat5[3];
<a name="l01175"></a>01175   <span class="keywordtype">double</span> mat11[3], mat22[3], mat33[3], mat44[3], mat55[3];
<a name="l01176"></a>01176   
<a name="l01177"></a>01177 <span class="comment">//  if (n_soln == 0) return</span>
<a name="l01178"></a>01178   <span class="keywordflow">if</span> (*n_soln == 0)
<a name="l01179"></a>01179     <span class="keywordflow">return</span>;
<a name="l01180"></a>01180 
<a name="l01181"></a>01181 <span class="comment">//  ! Define body frame (ex, ey, ez)</span>
<a name="l01182"></a>01182 <span class="comment">//  ex(:) = b_a1a3(:)</span>
<a name="l01183"></a>01183   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01184"></a>01184     ex[i] = <a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>[i];
<a name="l01185"></a>01185 <span class="comment">//  call cross(r_a1n1, ex, ez)</span>
<a name="l01186"></a>01186   <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(<a class="code" href="PTripepClosure_8h.html#6e23bcd9ce73ac8c31f8ae3a30caf6ca">r_a1n1</a>, ex, ez);
<a name="l01187"></a>01187 <span class="comment">//  ez(:) = ez(:)/sqrt(dot_product(ez,ez))</span>
<a name="l01188"></a>01188   tmp_value = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(ez,ez));
<a name="l01189"></a>01189   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01190"></a>01190     ez[i] = ez[i]/tmp_value;
<a name="l01191"></a>01191 <span class="comment">//  call cross(ez, ex, ey)</span>
<a name="l01192"></a>01192   <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(ez, ex, ey);
<a name="l01193"></a>01193 <span class="comment">//  ! vertual bond vectors in the reference plane</span>
<a name="l01194"></a>01194 <span class="comment">//  b_a1a2(:) = -cos_alpha(1)*ex(:) + sin_alpha(1)*ey(:)</span>
<a name="l01195"></a>01195 <span class="comment">//  b_a3a2(:) = cos_alpha(3)*ex(:) + sin_alpha(3)*ey(:)</span>
<a name="l01196"></a>01196   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01197"></a>01197    {
<a name="l01198"></a>01198     b_a1a2[i] = -<a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[0]*ex[i] + <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[0]*ey[i];
<a name="l01199"></a>01199     b_a3a2[i] = <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[2]*ex[i] + <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[2]*ey[i];
<a name="l01200"></a>01200    }
<a name="l01201"></a>01201 <span class="comment">//  !! Define cone coordinates for each angle joint.</span>
<a name="l01202"></a>01202 <span class="comment">//  ! (p_s,s1,s2) and (p_t,t1,t2):  Right Orthonormal systems</span>
<a name="l01203"></a>01203 <span class="comment">//  ! residue 1</span>
<a name="l01204"></a>01204 <span class="comment">//  p_s(:,1) = -ex(:)</span>
<a name="l01205"></a>01205 <span class="comment">//  s1(:,1)  = ez(:)  ! (p_s)X(p_t)/||(p_s)X(p_t)||</span>
<a name="l01206"></a>01206 <span class="comment">//  s2(:,1)  = ey(:)  ! p_s X s1</span>
<a name="l01207"></a>01207 <span class="comment">//  p_t(:,1) = b_a1a2(:)</span>
<a name="l01208"></a>01208 <span class="comment">//  t1(:,1)  = ez(:)  ! s1</span>
<a name="l01209"></a>01209 <span class="comment">//  t2(:,1)  = sin_alpha(1)*ex(:) + cos_alpha(1)*ey(:) ! p_t X t1</span>
<a name="l01210"></a>01210   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01211"></a>01211    {
<a name="l01212"></a>01212     p_s[0][i] = -ex[i];
<a name="l01213"></a>01213     s1[0][i]  = ez[i];
<a name="l01214"></a>01214     s2[0][i]  = ey[i];
<a name="l01215"></a>01215     p_t[0][i] = b_a1a2[i];
<a name="l01216"></a>01216     t1[0][i]  = ez[i];
<a name="l01217"></a>01217     t2[0][i]  = <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[0]*ex[i] + <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[0]*ey[i];
<a name="l01218"></a>01218    }
<a name="l01219"></a>01219 <span class="comment">//  ! residue 2</span>
<a name="l01220"></a>01220 <span class="comment">//  p_s(:,2) = -b_a1a2(:)</span>
<a name="l01221"></a>01221 <span class="comment">//  s1(:,2)  = -ez(:)</span>
<a name="l01222"></a>01222 <span class="comment">//  s2(:,2)  = t2(:,1)  ! sina1*ex(:) + cosa1*ey(:)</span>
<a name="l01223"></a>01223 <span class="comment">//  p_t(:,2) = -b_a3a2(:)</span>
<a name="l01224"></a>01224 <span class="comment">//  t1(:,2)  = -ez(:)</span>
<a name="l01225"></a>01225 <span class="comment">//  t2(:,2)  = sin_alpha(3)*ex(:) - cos_alpha(3)*ey(:) </span>
<a name="l01226"></a>01226   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01227"></a>01227    {
<a name="l01228"></a>01228     p_s[1][i] = -b_a1a2[i];
<a name="l01229"></a>01229     s1[1][i]  = -ez[i];
<a name="l01230"></a>01230     s2[1][i]  = t2[0][i];
<a name="l01231"></a>01231     p_t[1][i] = -b_a3a2[i];
<a name="l01232"></a>01232     t1[1][i]  = -ez[i];
<a name="l01233"></a>01233     t2[1][i]  = <a class="code" href="PTripepClosure_8h.html#ac884b9bb6c7fe15a1cfec02d7b675c2">sin_alpha</a>[2]*ex[i] - <a class="code" href="PTripepClosure_8h.html#43814b3798a1cba7b0c1be5240b238e0">cos_alpha</a>[2]*ey[i];
<a name="l01234"></a>01234    }
<a name="l01235"></a>01235 <span class="comment">//  ! residue 3</span>
<a name="l01236"></a>01236 <span class="comment">//  p_s(:,3) = b_a3a2(:)</span>
<a name="l01237"></a>01237 <span class="comment">//  s2(:,3)  = t2(:,2)   ! sina3*ex(:) + cosa3*ey(:) </span>
<a name="l01238"></a>01238 <span class="comment">//  s1(:,3)  = ez(:)  </span>
<a name="l01239"></a>01239 <span class="comment">//  p_t(:,3) = ex(:)</span>
<a name="l01240"></a>01240 <span class="comment">//  t1(:,3) =  ez(:) </span>
<a name="l01241"></a>01241 <span class="comment">//  t2(:,3) = -ey(:) </span>
<a name="l01242"></a>01242   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01243"></a>01243    {
<a name="l01244"></a>01244     p_s[2][i] = b_a3a2[i];
<a name="l01245"></a>01245     s2[2][i]  = t2[1][i]; 
<a name="l01246"></a>01246     s1[2][i]  = ez[i];
<a name="l01247"></a>01247     p_t[2][i] = ex[i];
<a name="l01248"></a>01248     t1[2][i] =  ez[i];
<a name="l01249"></a>01249     t2[2][i] = -ey[i];
<a name="l01250"></a>01250    }
<a name="l01251"></a>01251 <span class="comment">//  ! scale vectors</span>
<a name="l01252"></a>01252 <span class="comment">//  do i = 1, 3</span>
<a name="l01253"></a>01253 <span class="comment">//     p_s_c(:,i) = p_s(:,i)*cos_xi(i)</span>
<a name="l01254"></a>01254 <span class="comment">//     s1_s(:,i)  =  s1(:,i)*sin_xi(i)</span>
<a name="l01255"></a>01255 <span class="comment">//     s2_s(:,i)  =  s2(:,i)*sin_xi(i)</span>
<a name="l01256"></a>01256 <span class="comment">//     p_t_c(:,i) = p_t(:,i)*cos_eta(i)</span>
<a name="l01257"></a>01257 <span class="comment">//     t1_s(:,i)  =  t1(:,i)*sin_eta(i)</span>
<a name="l01258"></a>01258 <span class="comment">//     t2_s(:,i)  =  t2(:,i)*sin_eta(i)</span>
<a name="l01259"></a>01259 <span class="comment">//  end do</span>
<a name="l01260"></a>01260   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01261"></a>01261     <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l01262"></a>01262      {
<a name="l01263"></a>01263       p_s_c[i][j] = p_s[i][j]*<a class="code" href="PTripepClosure_8h.html#8269e50c354358511ac656124788ceb1">cos_xi</a>[i];
<a name="l01264"></a>01264       s1_s[i][j]  = s1[i][j]*<a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[i];
<a name="l01265"></a>01265       s2_s[i][j]  = s2[i][j]*sin_xi[i];
<a name="l01266"></a>01266       p_t_c[i][j] = p_t[i][j]*<a class="code" href="PTripepClosure_8h.html#a52158c7dc00a376a29c9c2fb731396f">cos_eta</a>[i];
<a name="l01267"></a>01267       t1_s[i][j]  = t1[i][j]*<a class="code" href="PTripepClosure_8h.html#d15cb2aaa72b0c7b5876072c271d9ff3">sin_eta</a>[i];
<a name="l01268"></a>01268       t2_s[i][j]  = t2[i][j]*sin_eta[i];
<a name="l01269"></a>01269      }
<a name="l01270"></a>01270 
<a name="l01271"></a>01271 <span class="comment">//  ! initial sig(1)</span>
<a name="l01272"></a>01272 <span class="comment">//  r_tmp(:) = (r_a1n1(:)/len_na(1) - p_s_c(:,1))/sin_xi(1)</span>
<a name="l01273"></a>01273   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01274"></a>01274     r_tmp[i] = (r_a1n1[i]/<a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[0] - p_s_c[0][i])/<a class="code" href="PTripepClosure_8h.html#095180ef4cf5006c83972c19235fcc94">sin_xi</a>[0];
<a name="l01275"></a>01275 <span class="comment">//  call calc_bnd_ang(s1(:,1), r_tmp, angle)</span>
<a name="l01276"></a>01276   <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(s1[0], r_tmp, &amp;angle);
<a name="l01277"></a>01277 <span class="comment">//  sig1_init = sign(angle, dot_product(r_tmp(:),s2(:,1)))</span>
<a name="l01278"></a>01278   sig1_init = <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(angle, <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(r_tmp,s2[0]));
<a name="l01279"></a>01279 
<a name="l01280"></a>01280 <span class="comment">//  ! CA</span>
<a name="l01281"></a>01281 <span class="comment">//  r_a(:,1) = r_a1(:)</span>
<a name="l01282"></a>01282 <span class="comment">//  r_a(:,2) = r_a1(:) + len_aa(2)*b_a1a2(:)</span>
<a name="l01283"></a>01283 <span class="comment">//  r_a(:,3) = r_a3(:)</span>
<a name="l01284"></a>01284 <span class="comment">//  r0(:) = r_a1(:)</span>
<a name="l01285"></a>01285   <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01286"></a>01286    {
<a name="l01287"></a>01287     r_a[0][i] = r_a1[i];
<a name="l01288"></a>01288     r_a[1][i] = r_a1[i] + <a class="code" href="PTripepClosure_8h.html#924e2204781c529dadba6d8f0a5d0507">len_aa</a>[1]*b_a1a2[i];
<a name="l01289"></a>01289     r_a[2][i] = r_a3[i];
<a name="l01290"></a>01290     r0[i] = r_a1[i];
<a name="l01291"></a>01291    }
<a name="l01292"></a>01292 
<a name="l01293"></a>01293 <span class="comment">//  do i_soln = 1, n_soln </span>
<a name="l01294"></a>01294   <span class="keywordflow">for</span>(i_soln=0;i_soln&lt;*n_soln;i_soln++)
<a name="l01295"></a>01295    {
<a name="l01296"></a>01296 <span class="comment">//     half_tan(3) = roots(i_soln)</span>
<a name="l01297"></a>01297      half_tan[2] = roots[i_soln];
<a name="l01298"></a>01298 <span class="comment">//     half_tan(2) = calc_t2(half_tan(3))</span>
<a name="l01299"></a>01299      half_tan[1] = <a class="code" href="PTripepClosure_8h.html#5d51d54f1f64b63f2edc36ed996eaee8">calc_t2</a>(half_tan[2]);
<a name="l01300"></a>01300 <span class="comment">//     half_tan(1) = calc_t1(half_tan(3), half_tan(2))</span>
<a name="l01301"></a>01301      half_tan[0] = <a class="code" href="PTripepClosure_8h.html#97edf0a2ece832b26e737203711dad8b">calc_t1</a>(half_tan[2], half_tan[1]);
<a name="l01302"></a>01302 <span class="comment">//     do i = 1, 3</span>
<a name="l01303"></a>01303 <span class="comment">//        ht = half_tan(i)</span>
<a name="l01304"></a>01304 <span class="comment">//        tmp = 1.0d0 + ht*ht</span>
<a name="l01305"></a>01305 <span class="comment">//        cos_tau(i) = (1.0d0 - ht*ht)/tmp</span>
<a name="l01306"></a>01306 <span class="comment">//        sin_tau(i) = 2.0d0*ht/tmp</span>
<a name="l01307"></a>01307 <span class="comment">//     end do</span>
<a name="l01308"></a>01308      <span class="keywordflow">for</span>(i=1;i&lt;=3;i++)
<a name="l01309"></a>01309       {
<a name="l01310"></a>01310        ht = half_tan[i-1];
<a name="l01311"></a>01311        tmp = 1.0e0 + ht*ht;
<a name="l01312"></a>01312        cos_tau[i] = (1.0e0 - ht*ht)/tmp;
<a name="l01313"></a>01313        sin_tau[i] = 2.0e0*ht/tmp;
<a name="l01314"></a>01314       }
<a name="l01315"></a>01315 <span class="comment">//     cos_tau(0) = cos_tau(3)</span>
<a name="l01316"></a>01316      cos_tau[0] = cos_tau[3];
<a name="l01317"></a>01317 <span class="comment">//     sin_tau(0) = sin_tau(3)</span>
<a name="l01318"></a>01318      sin_tau[0] = sin_tau[3];
<a name="l01319"></a>01319 <span class="comment">//     printf("cos: %7.3f%7.3f%7.3f%7.3f\n", cos_tau[0], cos_tau[1], cos_tau[2], cos_tau[3]);</span>
<a name="l01320"></a>01320 <span class="comment">//     printf("sin: %7.3f%7.3f%7.3f%7.3f\n", sin_tau[0], sin_tau[1], sin_tau[2], sin_tau[3]);</span>
<a name="l01321"></a>01321 <span class="comment">//     do i = 1, 3</span>
<a name="l01322"></a>01322 <span class="comment">//        j = i - 1</span>
<a name="l01323"></a>01323 <span class="comment">//        cos_sig(i) = cos_delta(j)*cos_tau(j) + sin_delta(j)*sin_tau(j)</span>
<a name="l01324"></a>01324 <span class="comment">//        sin_sig(i) = sin_delta(j)*cos_tau(j) - cos_delta(j)*sin_tau(j)</span>
<a name="l01325"></a>01325 <span class="comment">//     end do</span>
<a name="l01326"></a>01326      <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01327"></a>01327       {
<a name="l01328"></a>01328        cos_sig[i] = <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[i]*cos_tau[i] + <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[i]*sin_tau[i];
<a name="l01329"></a>01329        sin_sig[i] = <a class="code" href="PTripepClosure_8h.html#7d59882c9f6c099371d01485878291d4">sin_delta</a>[i]*cos_tau[i] - <a class="code" href="PTripepClosure_8h.html#e0a7e73c45e3f0e994fd88932596544c">cos_delta</a>[i]*sin_tau[i];
<a name="l01330"></a>01330       }
<a name="l01331"></a>01331 <span class="comment">//     do i = 1, 3</span>
<a name="l01332"></a>01332 <span class="comment">//        r_s(:) = p_s_c(:,i) + cos_sig(i)*s1_s(:,i) + sin_sig(i)*s2_s(:,i)</span>
<a name="l01333"></a>01333 <span class="comment">//        r_t(:) = p_t_c(:,i) + cos_tau(i)*t1_s(:,i) + sin_tau(i)*t2_s(:,i) </span>
<a name="l01334"></a>01334 <span class="comment">//        r_n(:,i) = r_s(:)*len_na(i) + r_a(:,i)</span>
<a name="l01335"></a>01335 <span class="comment">//        r_c(:,i) = r_t(:)*len_ac(i) + r_a(:,i)</span>
<a name="l01336"></a>01336 <span class="comment">//     end do</span>
<a name="l01337"></a>01337     <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01338"></a>01338       <span class="keywordflow">for</span>(j=0;j&lt;3;j++)
<a name="l01339"></a>01339        {
<a name="l01340"></a>01340         r_s[j] = p_s_c[i][j] + cos_sig[i]*s1_s[i][j] + sin_sig[i]*s2_s[i][j];
<a name="l01341"></a>01341         r_t[j] = p_t_c[i][j] + cos_tau[i+1]*t1_s[i][j] + sin_tau[i+1]*t2_s[i][j];
<a name="l01342"></a>01342         r_n[i][j] = r_s[j]*<a class="code" href="PTripepClosure_8h.html#1968ffbf0f791654cf81138f010adc5b">len_na</a>[i] + r_a[i][j];
<a name="l01343"></a>01343         r_c[i][j] = r_t[j]*<a class="code" href="PTripepClosure_8h.html#4129409f44f8e72ace657234f3172d48">len_ac</a>[i] + r_a[i][j];
<a name="l01344"></a>01344        }
<a name="l01345"></a>01345       
<a name="l01346"></a>01346 <span class="comment">//     ! rotate back atoms by -(sig(1) - sig1_init) around -ex</span>
<a name="l01347"></a>01347 <span class="comment">//     sig1 = atan2(sin_sig(1), cos_sig(1))</span>
<a name="l01348"></a>01348      sig1 = atan2(sin_sig[0], cos_sig[0]);
<a name="l01349"></a>01349 <span class="comment">//     call quaternion(-ex, -(sig1 - sig1_init)*0.25d0, p)</span>
<a name="l01350"></a>01350      ex_tmp[0] = -ex[0];
<a name="l01351"></a>01351      ex_tmp[1] = -ex[1];
<a name="l01352"></a>01352      ex_tmp[2] = -ex[2];
<a name="l01353"></a>01353      tmp_value = -(sig1-sig1_init)*0.25;
<a name="l01354"></a>01354      <a class="code" href="PTripepClosure_8h.html#020855c4fb206a413e0322064b26a22a">quaternion</a>(ex_tmp, tmp_value, p);
<a name="l01355"></a>01355 <span class="comment">//     call rotation_matrix(p, Us)</span>
<a name="l01356"></a>01356      <a class="code" href="PTripepClosure_8h.html#b4dcc0bfdb83aec6776142dc80418005">rotation_matrix</a>(p, Us);
<a name="l01357"></a>01357      
<a name="l01358"></a>01358 <span class="comment">//     r_soln_n(:,1,i_soln) = r_n1(:)</span>
<a name="l01359"></a>01359 <span class="comment">//     r_soln_a(:,1,i_soln) = r_a1(:)</span>
<a name="l01360"></a>01360 <span class="comment">//     r_soln_c(:,1,i_soln) = matmul(Us, r_c(:,1) - r0(:)) + r0(:)</span>
<a name="l01361"></a>01361 <span class="comment">//     r_soln_n(:,2,i_soln) = matmul(Us, r_n(:,2) - r0(:)) + r0(:)</span>
<a name="l01362"></a>01362 <span class="comment">//     r_soln_a(:,2,i_soln) = matmul(Us, r_a(:,2) - r0(:)) + r0(:)</span>
<a name="l01363"></a>01363 <span class="comment">//     r_soln_c(:,2,i_soln) = matmul(Us, r_c(:,2) - r0(:)) + r0(:)</span>
<a name="l01364"></a>01364 <span class="comment">//     r_soln_n(:,3,i_soln) = matmul(Us, r_n(:,3) - r0(:)) + r0(:)</span>
<a name="l01365"></a>01365 <span class="comment">//     r_soln_a(:,3,i_soln) = r_a3(:)</span>
<a name="l01366"></a>01366 <span class="comment">//     r_soln_c(:,3,i_soln) = r_c3(:)</span>
<a name="l01367"></a>01367      <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01368"></a>01368       {
<a name="l01369"></a>01369        mat11[i] = r_c[0][i]-r0[i];
<a name="l01370"></a>01370        mat22[i] = r_n[1][i]-r0[i];
<a name="l01371"></a>01371        mat33[i] = r_a[1][i]-r0[i];
<a name="l01372"></a>01372        mat44[i] = r_c[1][i]-r0[i];
<a name="l01373"></a>01373        mat55[i] = r_n[2][i]-r0[i];
<a name="l01374"></a>01374       }
<a name="l01375"></a>01375      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us,mat11,mat1);
<a name="l01376"></a>01376      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us,mat22,mat2);
<a name="l01377"></a>01377      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us,mat33,mat3);
<a name="l01378"></a>01378      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us,mat44,mat4);
<a name="l01379"></a>01379      <a class="code" href="PTripepClosure_8h.html#1e556d920b96c73558096d6b002aa86a">matmul</a>(Us,mat55,mat5);
<a name="l01380"></a>01380      <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01381"></a>01381       {
<a name="l01382"></a>01382        r_soln_n[i_soln][0][i] = r_n1[i];
<a name="l01383"></a>01383        r_soln_a[i_soln][0][i] = r_a1[i];
<a name="l01384"></a>01384        r_soln_c[i_soln][0][i] = mat1[i] + r0[i];
<a name="l01385"></a>01385        r_soln_n[i_soln][1][i] = mat2[i] + r0[i];
<a name="l01386"></a>01386        r_soln_a[i_soln][1][i] = mat3[i] + r0[i];
<a name="l01387"></a>01387        r_soln_c[i_soln][1][i] = mat4[i] + r0[i];
<a name="l01388"></a>01388        r_soln_n[i_soln][2][i] = mat5[i] + r0[i];
<a name="l01389"></a>01389        r_soln_a[i_soln][2][i] = r_a3[i];
<a name="l01390"></a>01390        r_soln_c[i_soln][2][i] = r_c3[i];
<a name="l01391"></a>01391       }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 
<a name="l01394"></a>01394 <span class="comment">//     if (print_level &gt; 0) then</span>
<a name="l01395"></a>01395      <span class="keywordflow">if</span> (<a class="code" href="PTripepClosure_8h.html#954d0af31e6dc5a8e0942494f03bc417">print_level</a> &gt; 0)
<a name="l01396"></a>01396       {
<a name="l01397"></a>01397 <span class="comment">//        print*, 'roots: t0, t2, t1', i_soln</span>
<a name="l01398"></a>01398         <span class="comment">// Ankur Dhanik printf("roots: t0, t2, t1 %d\n", i_soln);</span>
<a name="l01399"></a>01399 <span class="comment">//        write(*,"(3f15.6)") half_tan(3), half_tan(2), half_tan(1)</span>
<a name="l01400"></a>01400         <span class="comment">// Ankur Dhanik printf("%15.6f %15.6f %15.6f\n", half_tan[2], half_tan[1], half_tan[0]);</span>
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 <span class="comment">//        rr_a1c1(:) = r_soln_c(:,1,i_soln) - r_soln_a(:,1,i_soln)</span>
<a name="l01403"></a>01403 <span class="comment">//        rr_c1n2(:) = r_soln_n(:,2,i_soln) - r_soln_c(:,1,i_soln)</span>
<a name="l01404"></a>01404 <span class="comment">//        rr_n2a2(:) = r_soln_a(:,2,i_soln) - r_soln_n(:,2,i_soln)</span>
<a name="l01405"></a>01405 <span class="comment">//        rr_a2c2(:) = r_soln_c(:,2,i_soln) - r_soln_a(:,2,i_soln)</span>
<a name="l01406"></a>01406 <span class="comment">//        rr_c2n3(:) = r_soln_n(:,3,i_soln) - r_soln_c(:,2,i_soln)</span>
<a name="l01407"></a>01407 <span class="comment">//        rr_n3a3(:) = r_soln_a(:,3,i_soln) - r_soln_n(:,3,i_soln)</span>
<a name="l01408"></a>01408 <span class="comment">//        rr_a1a2(:) = r_soln_a(:,2,i_soln) - r_soln_a(:,1,i_soln)</span>
<a name="l01409"></a>01409 <span class="comment">//        rr_a2a3(:) = r_soln_a(:,3,i_soln) - r_soln_a(:,2,i_soln)</span>
<a name="l01410"></a>01410         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01411"></a>01411          {
<a name="l01412"></a>01412           rr_a1c1[i] = r_soln_c[i_soln][0][i] - r_soln_a[i_soln][0][i];
<a name="l01413"></a>01413           rr_c1n2[i] = r_soln_n[i_soln][1][i] - r_soln_c[i_soln][0][i];
<a name="l01414"></a>01414           rr_n2a2[i] = r_soln_a[i_soln][1][i] - r_soln_n[i_soln][1][i];
<a name="l01415"></a>01415           rr_a2c2[i] = r_soln_c[i_soln][1][i] - r_soln_a[i_soln][1][i];
<a name="l01416"></a>01416           rr_c2n3[i] = r_soln_n[i_soln][2][i] - r_soln_c[i_soln][1][i];
<a name="l01417"></a>01417           rr_n3a3[i] = r_soln_a[i_soln][2][i] - r_soln_n[i_soln][2][i];
<a name="l01418"></a>01418           rr_a1a2[i] = r_soln_a[i_soln][1][i] - r_soln_a[i_soln][0][i];
<a name="l01419"></a>01419           rr_a2a3[i] = r_soln_a[i_soln][2][i] - r_soln_a[i_soln][1][i];
<a name="l01420"></a>01420          }
<a name="l01421"></a>01421               
<a name="l01422"></a>01422 <span class="comment">//        a1c1 = sqrt(dot_product(rr_a1c1, rr_a1c1))</span>
<a name="l01423"></a>01423 <span class="comment">//        c1n2 = sqrt(dot_product(rr_c1n2, rr_c1n2))</span>
<a name="l01424"></a>01424 <span class="comment">//        n2a2 = sqrt(dot_product(rr_n2a2, rr_n2a2))</span>
<a name="l01425"></a>01425 <span class="comment">//        a2c2 = sqrt(dot_product(rr_a2c2, rr_a2c2))</span>
<a name="l01426"></a>01426 <span class="comment">//        c2n3 = sqrt(dot_product(rr_c2n3, rr_c2n3))</span>
<a name="l01427"></a>01427 <span class="comment">//        n3a3 = sqrt(dot_product(rr_n3a3, rr_n3a3))</span>
<a name="l01428"></a>01428 <span class="comment">//       a1a2 = sqrt(dot_product(rr_a1a2, rr_a1a2))</span>
<a name="l01429"></a>01429 <span class="comment">//        a2a3 = sqrt(dot_product(rr_a2a3, rr_a2a3))</span>
<a name="l01430"></a>01430         a1c1 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_a1c1, rr_a1c1));
<a name="l01431"></a>01431         c1n2 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_c1n2, rr_c1n2));
<a name="l01432"></a>01432         n2a2 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_n2a2, rr_n2a2));
<a name="l01433"></a>01433         a2c2 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_a2c2, rr_a2c2));
<a name="l01434"></a>01434         c2n3 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_c2n3, rr_c2n3));
<a name="l01435"></a>01435         n3a3 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_n3a3, rr_n3a3));
<a name="l01436"></a>01436         a1a2 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_a1a2, rr_a1a2));
<a name="l01437"></a>01437         a2a3 = sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(rr_a2a3, rr_a2a3));
<a name="l01438"></a>01438 
<a name="l01439"></a>01439         <span class="comment">/*  commented out by Ankur Dhanik</span>
<a name="l01440"></a>01440 <span class="comment">//        write(*,"('na: n2a2, n3a3 = ', 4f9.3)") len0(3), n2a2, len0(6), n3a3</span>
<a name="l01441"></a>01441 <span class="comment">        printf("na: n2a2, n3a3 = %9.3f%9.3f%9.3f%9.3f\n", len0[2], n2a2, len0[5], n3a3);</span>
<a name="l01442"></a>01442 <span class="comment">//        write(*,"('ac: a1c1, a2c2 = ', 4f9.3)") len0(1), a1c1, len0(4), a2c2</span>
<a name="l01443"></a>01443 <span class="comment">        printf("ac: a1c1, a2c2 = %9.3f%9.3f%9.3f%9.3f\n", len0[0], a1c1, len0[3], a2c2);</span>
<a name="l01444"></a>01444 <span class="comment">//        write(*,"('cn: c1n2, c2n3 = ', 4f9.3)") len0(2), c1n2, len0(5), c2n3</span>
<a name="l01445"></a>01445 <span class="comment">        printf("cn: c1n2, c2n3 = %9.3f%9.3f%9.3f%9.3f\n", len0[1], c1n2, len0[4], c2n3);</span>
<a name="l01446"></a>01446 <span class="comment">//        write(*,"('aa: a1a2, a2a3 = ', 4f9.3)") len_aa(2), a1a2, len_aa(3), a2a3</span>
<a name="l01447"></a>01447 <span class="comment">        printf("aa: a1a2, a2a3 = %9.3f%9.3f%9.3f%9.3f\n", len_aa[1], a1a2, len_aa[2], a2a3);</span>
<a name="l01448"></a>01448 <span class="comment">        */</span>
<a name="l01449"></a>01449 <span class="comment">//        call calc_bnd_ang(b_a1a3, rr_a1a2/a1a2, a3a1a2)</span>
<a name="l01450"></a>01450         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01451"></a>01451           tmp_array[i] = rr_a1a2[i]/a1a2;
<a name="l01452"></a>01452         <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<a class="code" href="PTripepClosure_8h.html#671b4c7936541592e62750bda3cce779">b_a1a3</a>, tmp_array, &amp;a3a1a2);
<a name="l01453"></a>01453 <span class="comment">//        call calc_bnd_ang(rr_a2a3/a2a3, b_a1a3, a2a3a1)</span>
<a name="l01454"></a>01454         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01455"></a>01455           tmp_array[i] = rr_a2a3[i]/a2a3;
<a name="l01456"></a>01456         <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(tmp_array, b_a1a3, &amp;a2a3a1);
<a name="l01457"></a>01457 <span class="comment">//        write(*,"('alpha1, alpha3 = ', 2f9.3)") (pi-a3a1a2)*rad2deg, (pi-a2a3a1)*rad2deg</span>
<a name="l01458"></a>01458         <span class="comment">// commented out by Ankur printf("alpha1, alpha3 = %9.3f%9.3f\n", (pi-a3a1a2)*rad2deg, (pi-a2a3a1)*rad2deg);</span>
<a name="l01459"></a>01459 <span class="comment">//        call calc_bnd_ang(b_a1n1, rr_a1c1/a1c1, n1a1c1)</span>
<a name="l01460"></a>01460         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01461"></a>01461           tmp_array[i] = rr_a1c1[i]/a1c1;
<a name="l01462"></a>01462         <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<a class="code" href="PTripepClosure_8h.html#87cb2c2c73dfaae6ee90bd3c10f795b4">b_a1n1</a>, tmp_array, &amp;n1a1c1);
<a name="l01463"></a>01463 <span class="comment">//        call calc_bnd_ang(b_a3c3, -rr_n3a3/n3a3, n3a3c3)</span>
<a name="l01464"></a>01464         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01465"></a>01465           tmp_array[i] = -rr_n3a3[i]/n3a3;
<a name="l01466"></a>01466         <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<a class="code" href="PTripepClosure_8h.html#f8e0d5201a028f046f8381c0990b39c8">b_a3c3</a>, tmp_array, &amp;n3a3c3);
<a name="l01467"></a>01467 <span class="comment">//        call calc_bnd_ang(rr_a2c2/a2c2, -rr_n2a2/n2a2, n2a2c2)</span>
<a name="l01468"></a>01468         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01469"></a>01469          {
<a name="l01470"></a>01470           tmp_array1[i] = rr_a2c2[i]/a2c2;
<a name="l01471"></a>01471           tmp_array2[i] = -rr_n2a2[i]/n2a2;
<a name="l01472"></a>01472          }
<a name="l01473"></a>01473         <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(tmp_array1, tmp_array2, &amp;n2a2c2);
<a name="l01474"></a>01474         <span class="comment">/*commented out by Ankur Dhanik</span>
<a name="l01475"></a>01475 <span class="comment">//        write(*,"('ang_nac = ', 2f9.3)") b_ang0(1)*rad2deg, n1a1c1*rad2deg</span>
<a name="l01476"></a>01476 <span class="comment">        printf("ang_nac = %9.3f%9.3f\n", b_ang0[0]*rad2deg, n1a1c1*rad2deg);</span>
<a name="l01477"></a>01477 <span class="comment">//        write(*,"('ang_nac = ', 2f9.3)") b_ang0(4)*rad2deg, n2a2c2*rad2deg </span>
<a name="l01478"></a>01478 <span class="comment">        printf("ang_nac = %9.3f%9.3f\n", b_ang0[3]*rad2deg, n2a2c2*rad2deg);</span>
<a name="l01479"></a>01479 <span class="comment">//        write(*,"('ang_nac = ', 2f9.3)") b_ang0(7)*rad2deg, n3a3c3*rad2deg</span>
<a name="l01480"></a>01480 <span class="comment">        printf("ang_nac = %9.3f%9.3f\n", b_ang0[6]*rad2deg, n3a3c3*rad2deg);</span>
<a name="l01481"></a>01481 <span class="comment">        */</span>
<a name="l01482"></a>01482 <span class="comment">//        call calc_dih_ang(rr_a1c1/a1c1, rr_c1n2/c1n2, rr_n2a2/n2a2, a1c1n2a2)</span>
<a name="l01483"></a>01483         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01484"></a>01484          {
<a name="l01485"></a>01485           tmp_array1[i] = rr_a1c1[i]/a1c1;
<a name="l01486"></a>01486           tmp_array2[i] = rr_c1n2[i]/c1n2;
<a name="l01487"></a>01487           tmp_array3[i] = rr_n2a2[i]/n2a2;
<a name="l01488"></a>01488          }
<a name="l01489"></a>01489         <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(tmp_array1, tmp_array2, tmp_array3, &amp;a1c1n2a2);
<a name="l01490"></a>01490 <span class="comment">//        call calc_dih_ang(rr_a2c2/a2c2, rr_c2n3/c2n3, rr_n3a3/n3a3, a2c2n3a3)</span>
<a name="l01491"></a>01491         <span class="keywordflow">for</span>(i=0;i&lt;3;i++)
<a name="l01492"></a>01492          {
<a name="l01493"></a>01493           tmp_array1[i] = rr_a2c2[i]/a2c2;
<a name="l01494"></a>01494           tmp_array2[i] = rr_c2n3[i]/c2n3;
<a name="l01495"></a>01495           tmp_array3[i] = rr_n3a3[i]/n3a3;
<a name="l01496"></a>01496          }
<a name="l01497"></a>01497         <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(tmp_array1, tmp_array2, tmp_array3, &amp;a2c2n3a3);
<a name="l01498"></a>01498         <span class="comment">/*commented out by Ankur Dhanik</span>
<a name="l01499"></a>01499 <span class="comment">//        write(*,"('t_ang1 = ', 2f9.3)") t_ang0(1)*rad2deg, a1c1n2a2*rad2deg</span>
<a name="l01500"></a>01500 <span class="comment">        printf("t_ang1 = %9.3f%9.3f\n", t_ang0[0]*rad2deg, a1c1n2a2*rad2deg);</span>
<a name="l01501"></a>01501 <span class="comment">//        write(*,"('t_ang2 = ', 2f9.3)") t_ang0(2)*rad2deg, a2c2n3a3*rad2deg</span>
<a name="l01502"></a>01502 <span class="comment">        printf("t_ang2 = %9.3f%9.3f\n", t_ang0[1]*rad2deg, a2c2n3a3*rad2deg);</span>
<a name="l01503"></a>01503 <span class="comment">//     end if</span>
<a name="l01504"></a>01504 <span class="comment">       */</span>
<a name="l01505"></a>01505       }
<a name="l01506"></a>01506 
<a name="l01507"></a>01507 <span class="comment">//  end do</span>
<a name="l01508"></a>01508    }
<a name="l01509"></a>01509 
<a name="l01510"></a>01510   <span class="keywordflow">return</span>;
<a name="l01511"></a>01511 <span class="comment">//end subroutine coord_from_poly_roots</span>
<a name="l01512"></a>01512  }
<a name="l01514"></a>01514 <span class="comment">//function calc_t2(t0)</span>
<a name="l01515"></a><a class="code" href="PTripepClosure_8h.html#5d51d54f1f64b63f2edc36ed996eaee8">01515</a> <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#5d51d54f1f64b63f2edc36ed996eaee8">calc_t2</a>(<span class="keywordtype">double</span> t0)
<a name="l01516"></a>01516  {
<a name="l01517"></a>01517 <span class="comment">//  implicit none</span>
<a name="l01518"></a>01518 <span class="comment">//  real(dp), intent(in) :: t0</span>
<a name="l01519"></a>01519 <span class="comment">//  real(dp) :: calc_t2</span>
<a name="l01520"></a>01520   <span class="keywordtype">double</span> tmp_value;
<a name="l01521"></a>01521 <span class="comment">//  real(dp) :: B0, B1, B2, A0, A1, A2, A3, A4, B2_2, B2_3</span>
<a name="l01522"></a>01522   <span class="keywordtype">double</span> B0, B1, B2, A0, A1, A2, A3, A4, B2_2, B2_3;
<a name="l01523"></a>01523 <span class="comment">//  real(dp) :: K0, K1, K2, K3, t0_2, t0_3, t0_4</span>
<a name="l01524"></a>01524   <span class="keywordtype">double</span> K0, K1, K2, K3, t0_2, t0_3, t0_4;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526 <span class="comment">//  t0_2 = t0*t0</span>
<a name="l01527"></a>01527   t0_2 = t0*t0;
<a name="l01528"></a>01528 <span class="comment">//  t0_3 = t0_2*t0</span>
<a name="l01529"></a>01529   t0_3 = t0_2*t0;
<a name="l01530"></a>01530 <span class="comment">//  t0_4 = t0_3*t0</span>
<a name="l01531"></a>01531   t0_4 = t0_3*t0;
<a name="l01532"></a>01532 
<a name="l01533"></a>01533 <span class="comment">//  A0 = Q(0,0) + Q(1,0)*t0 + Q(2,0)*t0_2 + Q(3,0)*t0_3 + Q(4,0)*t0_4</span>
<a name="l01534"></a>01534   A0 = <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0][0] + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0][1]*t0 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0][2]*t0_2 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0][3]*t0_3 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[0][4]*t0_4;
<a name="l01535"></a>01535 <span class="comment">//  A1 = Q(0,1) + Q(1,1)*t0 + Q(2,1)*t0_2 + Q(3,1)*t0_3 + Q(4,1)*t0_4</span>
<a name="l01536"></a>01536   A1 = <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1][0] + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1][1]*t0 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1][2]*t0_2 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1][3]*t0_3 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[1][4]*t0_4;
<a name="l01537"></a>01537 <span class="comment">//  A2 = Q(0,2) + Q(1,2)*t0 + Q(2,2)*t0_2 + Q(3,2)*t0_3 + Q(4,2)*t0_4</span>
<a name="l01538"></a>01538   A2 = <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2][0] + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2][1]*t0 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2][2]*t0_2 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2][3]*t0_3 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[2][4]*t0_4;
<a name="l01539"></a>01539 <span class="comment">//  A3 = Q(0,3) + Q(1,3)*t0 + Q(2,3)*t0_2 + Q(3,3)*t0_3 + Q(4,3)*t0_4</span>
<a name="l01540"></a>01540   A3 = <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3][0] + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3][1]*t0 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3][2]*t0_2 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3][3]*t0_3 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[3][4]*t0_4;
<a name="l01541"></a>01541 <span class="comment">//  A4 = Q(0,4) + Q(1,4)*t0 + Q(2,4)*t0_2 + Q(3,4)*t0_3 + Q(4,4)*t0_4</span>
<a name="l01542"></a>01542   A4 = <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4][0] + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4][1]*t0 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4][2]*t0_2 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4][3]*t0_3 + <a class="code" href="PTripepClosure_8h.html#3b45359d79a5d95ba95ea8c63201223e">Q</a>[4][4]*t0_4;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544 <span class="comment">//  B0 = R(0,0) + R(1,0)*t0 + R(2,0)*t0_2</span>
<a name="l01545"></a>01545   B0 = <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0][0] + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0][1]*t0 + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[0][2]*t0_2;
<a name="l01546"></a>01546 <span class="comment">//  B1 = R(0,1) + R(1,1)*t0 + R(2,1)*t0_2</span>
<a name="l01547"></a>01547   B1 = <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1][0] + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1][1]*t0 + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[1][2]*t0_2;
<a name="l01548"></a>01548 <span class="comment">//  B2 = R(0,2) + R(1,2)*t0 + R(2,2)*t0_2</span>
<a name="l01549"></a>01549   B2 = <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2][0] + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2][1]*t0 + <a class="code" href="PTripepClosure_8h.html#6e5c3a969ae14f4583ca7ef7f989262f">R</a>[2][2]*t0_2;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 <span class="comment">//  B2_2 = B2*B2</span>
<a name="l01552"></a>01552   B2_2 = B2*B2;
<a name="l01553"></a>01553 <span class="comment">//  B2_3 = B2_2*B2</span>
<a name="l01554"></a>01554   B2_3 = B2_2*B2;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556 <span class="comment">//  K0 = A2*B2 - A4*B0</span>
<a name="l01557"></a>01557   K0 = A2*B2 - A4*B0;
<a name="l01558"></a>01558 <span class="comment">//  K1 = A3*B2 - A4*B1</span>
<a name="l01559"></a>01559   K1 = A3*B2 - A4*B1;
<a name="l01560"></a>01560 <span class="comment">//  K2 = A1*B2_2 - K1*B0</span>
<a name="l01561"></a>01561   K2 = A1*B2_2 - K1*B0;
<a name="l01562"></a>01562 <span class="comment">//  K3 = K0*B2 - K1*B1</span>
<a name="l01563"></a>01563   K3 = K0*B2 - K1*B1;
<a name="l01564"></a>01564   
<a name="l01565"></a>01565 <span class="comment">//  calc_t2 = (K3*B0 - A0*B2_3)/(K2*B2 - K3*B1)</span>
<a name="l01566"></a>01566   tmp_value = (K3*B0 - A0*B2_3)/(K2*B2 - K3*B1);
<a name="l01567"></a>01567 
<a name="l01568"></a>01568   <span class="keywordflow">return</span> tmp_value;
<a name="l01569"></a>01569 <span class="comment">//end function calc_t2</span>
<a name="l01570"></a>01570  }
<a name="l01572"></a>01572 <span class="comment">//function calc_t1(t0, t2)</span>
<a name="l01573"></a><a class="code" href="PTripepClosure_8h.html#97edf0a2ece832b26e737203711dad8b">01573</a> <span class="keywordtype">double</span> <a class="code" href="PTripepClosure_8h.html#97edf0a2ece832b26e737203711dad8b">calc_t1</a>(<span class="keywordtype">double</span> t0, <span class="keywordtype">double</span> t2)
<a name="l01574"></a>01574  {
<a name="l01575"></a>01575 <span class="comment">//  implicit none</span>
<a name="l01576"></a>01576 <span class="comment">//  real(dp), intent(in) :: t0, t2</span>
<a name="l01577"></a>01577 <span class="comment">//  real(dp) :: calc_t1</span>
<a name="l01578"></a>01578   <span class="keywordtype">double</span> tmp_value;
<a name="l01579"></a>01579 <span class="comment">//  real(dp) :: U11, U12, U13, U31, U32, U33</span>
<a name="l01580"></a>01580   <span class="keywordtype">double</span> U11, U12, U13, U31, U32, U33;
<a name="l01581"></a>01581 <span class="comment">//  real(dp) :: t0_2, t2_2</span>
<a name="l01582"></a>01582   <span class="keywordtype">double</span> t0_2, t2_2;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584 <span class="comment">//  t0_2 = t0*t0</span>
<a name="l01585"></a>01585   t0_2 = t0*t0;
<a name="l01586"></a>01586 <span class="comment">//  t2_2 = t2*t2</span>
<a name="l01587"></a>01587   t2_2 = t2*t2;
<a name="l01588"></a>01588 
<a name="l01589"></a>01589 <span class="comment">//  U11 = C0(0,1) + C0(1,1)*t0 + C0(2,1)*t0_2</span>
<a name="l01590"></a>01590   U11 = <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[0][0] + <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[0][1]*t0 + <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[0][2]*t0_2;
<a name="l01591"></a>01591 <span class="comment">//  U12 = C1(0,1) + C1(1,1)*t0 + C1(2,1)*t0_2</span>
<a name="l01592"></a>01592   U12 = <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[0][0] + <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[0][1]*t0 + <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[0][2]*t0_2;
<a name="l01593"></a>01593 <span class="comment">//  U13 = C2(0,1) + C2(1,1)*t0 + C2(2,1)*t0_2</span>
<a name="l01594"></a>01594   U13 = <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[0][0] + <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[0][1]*t0 + <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[0][2]*t0_2;
<a name="l01595"></a>01595 <span class="comment">//  U31 = C0(0,2) + C0(1,2)*t2 + C0(2,2)*t2_2</span>
<a name="l01596"></a>01596   U31 = <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[1][0] + <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[1][1]*t2 + <a class="code" href="PTripepClosure_8h.html#487f97d75605a5a6ccbac4d7348c8280">C0</a>[1][2]*t2_2;
<a name="l01597"></a>01597 <span class="comment">//  U32 = C1(0,2) + C1(1,2)*t2 + C1(2,2)*t2_2</span>
<a name="l01598"></a>01598   U32 = <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[1][0] + <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[1][1]*t2 + <a class="code" href="PTripepClosure_8h.html#051ff4149520ada22b69a8be144f2038">C1</a>[1][2]*t2_2;
<a name="l01599"></a>01599 <span class="comment">//  U33 = C2(0,2) + C2(1,2)*t2 + C2(2,2)*t2_2</span>
<a name="l01600"></a>01600   U33 = <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[1][0] + <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[1][1]*t2 + <a class="code" href="PTripepClosure_8h.html#9d44591a1f3d1bbbb99a29a56b7242ad">C2</a>[1][2]*t2_2;
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 <span class="comment">//  calc_t1 = (U31*U13-U11*U33)/(U12*U33-U13*U32)</span>
<a name="l01603"></a>01603   tmp_value = (U31*U13-U11*U33)/(U12*U33-U13*U32);
<a name="l01604"></a>01604 
<a name="l01605"></a>01605   <span class="keywordflow">return</span> tmp_value;
<a name="l01606"></a>01606 <span class="comment">//end function calc_t1</span>
<a name="l01607"></a>01607  }
<a name="l01609"></a>01609 <span class="comment">//subroutine calc_dih_ang(r1, r2, r3, angle)</span>
<a name="l01610"></a><a class="code" href="PTripepClosure_8h.html#d643a1e676ed9d0a8ece4510764a42ce">01610</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#e080deae6221439aa79d9a64266dab63">calc_dih_ang</a>(<span class="keywordtype">double</span> r1[3], <span class="keywordtype">double</span> r2[3], <span class="keywordtype">double</span> r3[3], <span class="keywordtype">double</span> *angle)
<a name="l01611"></a>01611  {
<a name="l01615"></a>01615 <span class="comment">//  implicit none</span>
<a name="l01616"></a>01616 <span class="comment">//  real(dp), intent(in) :: r1(3), r2(3), r3(3)</span>
<a name="l01617"></a>01617 <span class="comment">//  real(dp), intent(out) :: angle</span>
<a name="l01618"></a>01618 <span class="comment">//  real(dp), dimension(3) :: p, q, s</span>
<a name="l01619"></a>01619   <span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[3], q[3], s[3];
<a name="l01620"></a>01620 <span class="comment">//  real(dp) :: arg</span>
<a name="l01621"></a>01621   <span class="keywordtype">double</span> arg;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 <span class="comment">//  call cross(r1, r2, p)</span>
<a name="l01624"></a>01624   <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(r1, r2, p);
<a name="l01625"></a>01625 <span class="comment">//  call cross(r2, r3, q)</span>
<a name="l01626"></a>01626   <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(r2, r3, q);
<a name="l01627"></a>01627 <span class="comment">//  call cross(r3, r1, s)</span>
<a name="l01628"></a>01628   <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(r3, r1, s);
<a name="l01629"></a>01629 <span class="comment">//  arg = dot_product(p,q)/sqrt(dot_product(p,p)*dot_product(q,q))</span>
<a name="l01630"></a>01630   arg = <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(p,q)/sqrt(<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(p,p)*<a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(q,q));
<a name="l01631"></a>01631 <span class="comment">//  arg = sign(min(abs(arg),1.0d0),arg) ! to be sure abs(arg)&lt;=1</span>
<a name="l01632"></a>01632   arg = <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(<a class="code" href="PTripepClosure_8h.html#9cc09fd5237e54feaa3e4cee4fedc869">min</a>(fabs(arg),1.0e0),arg);
<a name="l01633"></a>01633 <span class="comment">//  angle = sign(acos(arg), dot_product(s,r2))</span>
<a name="l01634"></a>01634   *angle = <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(acos(arg), <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(s,r2));
<a name="l01635"></a>01635 
<a name="l01636"></a>01636   <span class="keywordflow">return</span>;
<a name="l01637"></a>01637 <span class="comment">// end subroutine calc_dih_ang</span>
<a name="l01638"></a>01638  }
<a name="l01640"></a>01640 <span class="comment">//subroutine calc_bnd_ang(r1, r2, angle)</span>
<a name="l01641"></a><a class="code" href="PTripepClosure_8h.html#e0e2bb6a9c4850ae034b55db08ef17fb">01641</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#8d15e4f753f71a982803ba85d400334e">calc_bnd_ang</a>(<span class="keywordtype">double</span> r1[3], <span class="keywordtype">double</span> r2[3], <span class="keywordtype">double</span> *angle)
<a name="l01642"></a>01642  {
<a name="l01647"></a>01647 <span class="comment">//  implicit none</span>
<a name="l01648"></a>01648 <span class="comment">//  real(dp), intent(in) :: r1(3), r2(3)</span>
<a name="l01649"></a>01649 <span class="comment">//  real(dp), intent(out) :: angle</span>
<a name="l01650"></a>01650 <span class="comment">//  real(dp) :: arg</span>
<a name="l01651"></a>01651   <span class="keywordtype">double</span> arg;
<a name="l01652"></a>01652 
<a name="l01653"></a>01653 <span class="comment">//  arg = dot_product(r1, r2)</span>
<a name="l01654"></a>01654   arg = <a class="code" href="PTripepClosure_8h.html#d168c6bd6e9220010743327b140fae26">dot_product</a>(r1, r2);
<a name="l01655"></a>01655 <span class="comment">//  arg = sign(min(abs(arg),1.0d0),arg) ! to be sure abs(arg)&lt;=1</span>
<a name="l01656"></a>01656   arg = <a class="code" href="PTripepClosure_8h.html#a5de22a245d73b37b63e87f11f67094b">sign</a>(<a class="code" href="PTripepClosure_8h.html#9cc09fd5237e54feaa3e4cee4fedc869">min</a>(fabs(arg),1.0e0),arg);
<a name="l01657"></a>01657 <span class="comment">//  angle = acos(arg)</span>
<a name="l01658"></a>01658   *angle = acos(arg);
<a name="l01659"></a>01659   
<a name="l01660"></a>01660   <span class="keywordflow">return</span>;
<a name="l01661"></a>01661 <span class="comment">//end subroutine calc_bnd_ang</span>
<a name="l01662"></a>01662  }
<a name="l01664"></a>01664 <span class="comment">//subroutine cross(p, q, s)</span>
<a name="l01665"></a><a class="code" href="PTripepClosure_8h.html#bd012c0000f231f59e7fd5206823799c">01665</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#a8f1e1511ade1c21f0a01d0be1d095aa">cross</a>(<span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[3], <span class="keywordtype">double</span> q[3], <span class="keywordtype">double</span> s[3])
<a name="l01666"></a>01666  {
<a name="l01668"></a>01668 <span class="comment">//  implicit none</span>
<a name="l01669"></a>01669 <span class="comment">//  real(dp), dimension(:), intent(in) :: p, q</span>
<a name="l01670"></a>01670 <span class="comment">//  real(dp), dimension(:), intent(out) :: s</span>
<a name="l01671"></a>01671 
<a name="l01672"></a>01672 <span class="comment">//  s(1) = p(2)*q(3) - p(3)*q(2)</span>
<a name="l01673"></a>01673   s[0] = p[1]*q[2] - p[2]*q[1];
<a name="l01674"></a>01674 <span class="comment">//  s(2) = p(3)*q(1) - p(1)*q(3)</span>
<a name="l01675"></a>01675   s[1] = p[2]*q[0] - p[0]*q[2];
<a name="l01676"></a>01676 <span class="comment">//  s(3) = p(1)*q(2) - p(2)*q(1)</span>
<a name="l01677"></a>01677   s[2] = p[0]*q[1] - p[1]*q[0];
<a name="l01678"></a>01678 
<a name="l01679"></a>01679   <span class="keywordflow">return</span>;
<a name="l01680"></a>01680 <span class="comment">//end subroutine cross</span>
<a name="l01681"></a>01681  }
<a name="l01683"></a>01683 <span class="comment">//subroutine quaternion(axis, quarter_ang, p)</span>
<a name="l01684"></a><a class="code" href="PTripepClosure_8h.html#e9356d7314d0018cc461594f5c340eec">01684</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#020855c4fb206a413e0322064b26a22a">quaternion</a>(<span class="keywordtype">double</span> axis[3], <span class="keywordtype">double</span> quarter_ang, <span class="keywordtype">double</span> <a class="code" href="structp.html">p</a>[4])
<a name="l01685"></a>01685  {
<a name="l01689"></a>01689 <span class="comment">//  implicit none</span>
<a name="l01690"></a>01690 <span class="comment">//  real(dp), dimension(:), intent(in) :: axis</span>
<a name="l01691"></a>01691 <span class="comment">//  real(dp), intent(in) :: quarter_ang</span>
<a name="l01692"></a>01692 <span class="comment">//  real(dp), dimension(:), intent(out) :: p</span>
<a name="l01693"></a>01693 <span class="comment">//  real(dp) :: tan_w, tan_sqr, tan1, cosine, sine</span>
<a name="l01694"></a>01694   <span class="keywordtype">double</span> tan_w, tan_sqr, tan1, cosine, sine;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696 <span class="comment">//  tan_w = tan(quarter_ang)</span>
<a name="l01697"></a>01697   tan_w = tan(quarter_ang);
<a name="l01698"></a>01698 <span class="comment">//  tan_sqr = tan_w * tan_w</span>
<a name="l01699"></a>01699   tan_sqr = tan_w * tan_w;
<a name="l01700"></a>01700 <span class="comment">//  tan1 = 1.0d0 + tan_sqr</span>
<a name="l01701"></a>01701   tan1 = 1.0e0 + tan_sqr;
<a name="l01702"></a>01702 <span class="comment">//  cosine = (1.0d0 - tan_sqr)/tan1</span>
<a name="l01703"></a>01703   cosine = (1.0e0 - tan_sqr)/tan1;
<a name="l01704"></a>01704 <span class="comment">//  sine = 2.0d0*tan_w/tan1</span>
<a name="l01705"></a>01705   sine = 2.0e0*tan_w/tan1;
<a name="l01706"></a>01706 <span class="comment">//  p(1) = cosine</span>
<a name="l01707"></a>01707   p[0] = cosine;
<a name="l01708"></a>01708 <span class="comment">//  p(2:4) = axis(1:3) * sine</span>
<a name="l01709"></a>01709   p[1] = axis[0] * sine;
<a name="l01710"></a>01710   p[2] = axis[1] * sine;
<a name="l01711"></a>01711   p[3] = axis[2] * sine;
<a name="l01712"></a>01712 
<a name="l01713"></a>01713   <span class="keywordflow">return</span>;
<a name="l01714"></a>01714 <span class="comment">//end subroutine quaternion</span>
<a name="l01715"></a>01715  }
<a name="l01717"></a>01717 <span class="comment">//subroutine rotation_matrix(q, U)</span>
<a name="l01718"></a><a class="code" href="PTripepClosure_8h.html#b4dcc0bfdb83aec6776142dc80418005">01718</a> <span class="keywordtype">void</span> <a class="code" href="PTripepClosure_8h.html#b4dcc0bfdb83aec6776142dc80418005">rotation_matrix</a>(<span class="keywordtype">double</span> q[4], <span class="keywordtype">double</span> U[3][3])
<a name="l01719"></a>01719  {
<a name="l01723"></a>01723 <span class="comment">//  implicit none</span>
<a name="l01724"></a>01724 <span class="comment">//  real(dp), dimension(:), intent(in) :: q</span>
<a name="l01725"></a>01725 <span class="comment">//  real(dp), dimension(:,:), intent(out) :: U</span>
<a name="l01726"></a>01726 <span class="comment">//  real(dp) :: q0,q1,q2,q3,b0,b1,b2,b3,q00,q01,q02,q03,q11,q12,q13,q22,q23,q33  </span>
<a name="l01727"></a>01727   <span class="keywordtype">double</span> q0,q1,q2,q3,b0,b1,b2,b3,q00,q01,q02,q03,q11,q12,q13,q22,q23,q33;
<a name="l01728"></a>01728 
<a name="l01729"></a>01729 <span class="comment">//  q0 = q(1); q1 = q(2); q2 = q(3); q3 = q(4)</span>
<a name="l01730"></a>01730   q0 = q[0];
<a name="l01731"></a>01731   q1 = q[1];
<a name="l01732"></a>01732   q2 = q[2];
<a name="l01733"></a>01733   q3 = q[3];
<a name="l01734"></a>01734 <span class="comment">//  b0 = 2.0d0*q0; b1 = 2.0d0*q1</span>
<a name="l01735"></a>01735   b0 = 2.0e0*q0;
<a name="l01736"></a>01736   b1 = 2.0e0*q1;
<a name="l01737"></a>01737 <span class="comment">//  q00 = b0*q0-1.0d0; q02 = b0*q2; q03 = b0*q3</span>
<a name="l01738"></a>01738   q00 = b0*q0-1.0e0;
<a name="l01739"></a>01739   q02 = b0*q2;
<a name="l01740"></a>01740   q03 = b0*q3;
<a name="l01741"></a>01741 <span class="comment">//  q11 = b1*q1;       q12 = b1*q2; q13 = b1*q3  </span>
<a name="l01742"></a>01742   q11 = b1*q1;
<a name="l01743"></a>01743   q12 = b1*q2;
<a name="l01744"></a>01744   q13 = b1*q3;
<a name="l01745"></a>01745 <span class="comment">//  b2 = 2.0d0*q2; b3 = 2.0d0*q3</span>
<a name="l01746"></a>01746   b2 = 2.0e0*q2;
<a name="l01747"></a>01747   b3 = 2.0e0*q3;
<a name="l01748"></a>01748 <span class="comment">//  q01 = b0*q1; q22 = b2*q2; q23 = b2*q3; q33 = b3*q3 </span>
<a name="l01749"></a>01749   q01 = b0*q1;
<a name="l01750"></a>01750   q22 = b2*q2;
<a name="l01751"></a>01751   q23 = b2*q3;
<a name="l01752"></a>01752   q33 = b3*q3;
<a name="l01753"></a>01753 <span class="comment">//  U(1,1) = q00+q11; U(1,2) = q12-q03; U(1,3) = q13+q02</span>
<a name="l01754"></a>01754   U[0][0] = q00+q11;
<a name="l01755"></a>01755   U[0][1] = q12-q03;
<a name="l01756"></a>01756   U[0][2] = q13+q02;
<a name="l01757"></a>01757 <span class="comment">//  U(2,1) = q12+q03; U(2,2) = q00+q22; U(2,3) = q23-q01</span>
<a name="l01758"></a>01758   U[1][0] = q12+q03;
<a name="l01759"></a>01759   U[1][1] = q00+q22;
<a name="l01760"></a>01760   U[1][2] = q23-q01;
<a name="l01761"></a>01761 <span class="comment">//  U(3,1) = q13-q02; U(3,2) = q23+q01; U(3,3) = q00+q33</span>
<a name="l01762"></a>01762   U[2][0] = q13-q02;
<a name="l01763"></a>01763   U[2][1] = q23+q01;
<a name="l01764"></a>01764   U[2][2] = q00+q33;
<a name="l01765"></a>01765 
<a name="l01766"></a>01766   <span class="keywordflow">return</span>;
<a name="l01767"></a>01767 <span class="comment">//end subroutine rotation_matrix</span>
<a name="l01768"></a>01768  }
<a name="l01770"></a>01770 <span class="comment">//END MODULE tripep_closure</span>
</span></pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 26 16:06:04 2008 for LoopTK: Protein Loop Kinematic Toolkit by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1 </small></address>
</body>
</html>
